(()=>{var t={n:e=>{var a=e&&e.__esModule?()=>e.default:()=>e;return t.d(a,{a}),a},d:(e,a)=>{for(var s in a)t.o(a,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:a[s]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};(()=>{"use strict";t.r(e);const a=flarum.reg.get("core","common/extend"),s=flarum.reg.get("core","admin/components/BasicsPage");var n=t.n(s);const l=flarum.reg.get("core","admin/components/PermissionGrid");var o=t.n(l);const r=flarum.reg.get("core","admin/app");var i=t.n(r);const d=flarum.reg.get("core","admin/components/ExtensionPage");var g=t.n(d);const c=flarum.reg.get("core","admin/utils/saveSettings");var h=t.n(c);const u=flarum.reg.get("core","common/components/Alert");var b=t.n(u);const p=flarum.reg.get("core","common/components/Button");var v=t.n(p);const _=flarum.reg.get("core","common/components/FieldSet");var f=t.n(_);const y=flarum.reg.get("core","common/components/Switch");var x=t.n(y);const C=flarum.reg.get("core","common/components/Modal");var w=t.n(C);class N extends(w()){oninit(t){super.oninit(t),this.blogCategoriesOriginal=app.data.settings.blog_tags?app.data.settings.blog_tags.split("|"):[],this.blogCategories=app.data.settings.blog_tags?app.data.settings.blog_tags.split("|"):[],this.isSaving=!1,this.hasChanges=!1}title(){return"Select blog categories"}className(){return"Modal modal-dialog FlarumBlog-TagsModal"}content(){return m("div",null,m("div",{className:"Modal-body"},m("p",null,"Please select one or more tags that are considered blog tags."," ",m("a",{href:app.forum.attribute("baseUrl")+"/blog",target:"_blank"},"Visit your blog.")),m("table",{className:"FlarumBlog-TagsTable"},m("thead",null,m("th",{width:"35"}),m("th",null,"Tag name"),m("th",{width:"50"})),m("tbody",null,0===app.store.all("tags").length&&m("tr",null,m("td",{colspan:"3"},"You currently have no tags.")),app.store.all("tags").map((t=>{if(t.parent())return;const e=()=>{const e=this.blogCategories.indexOf(t.id());this.hasChanges=!0,e>=0?this.blogCategories.splice(e,1):this.blogCategories.push(t.id())};return m("tr",null,m("td",null,m("i",{className:t.icon()})),m("td",{onclick:e},t.name()),m("td",null,m(x(),{state:this.blogCategories.indexOf(t.id())>=0,onchange:e})))}))))),m("div",{style:"padding: 25px 30px; text-align: center;"},m(v(),{type:"submit",className:"Button Button--primary",loading:this.loading},this.hasChanges?"Save changes":"Close")))}onsubmit(t){if(t.preventDefault(),!this.hasChanges)return void this.hide();this.isSaving=!0;let e=[];this.blogCategories.map((t=>{app.store.getById("tags",t)&&e.push(t)})),h()({blog_tags:e.join("|")}).then((()=>{app.alerts.show(b(),{type:"success"},app.translator.trans("core.admin.settings.saved_message")),this.hide()})).catch((()=>{app.alerts.show(b(),{type:"error"},app.translator.trans("core.lib.error.generic_message"))})).then((()=>{this.isSaving=!1}))}}flarum.reg.add("vadkuz-flarum2-blog","admin/components/Modals/SelectCategoriesModal",N);const S=flarum.reg.get("core","admin/components/UploadImageButton");var E=t.n(S);class P extends(g()){oninit(t){var e,a,s,n,l,o,r,d,g;super.oninit(t),this.hasChanges=!1,this.isSaving=!1,this.redirectsEnabled=null!=(e=i().data.settings.blog_redirects_enabled)?e:"both",this.hideTagsInList=null==(a=i().data.settings.blog_hide_tags)||a,this.allowComments=null==(s=i().data.settings.blog_allow_comments)||s,this.hideOnDiscussionList=null!=(n=i().data.settings.blog_filter_discussion_list)&&n,this.requiresReviewOnPost=null!=(l=i().data.settings.blog_requires_review)&&l,this.addCategoryHierarchy=null==(o=i().data.settings.blog_category_hierarchy)||o,this.addSidebarNav=null==(r=i().data.settings.blog_add_sidebar_nav)||r,this.featuredCount=null!=(d=i().data.settings.blog_featured_count)?d:3,this.blogAddHero=null==(g=i().data.settings.blog_add_hero)||g,i().forum.data.attributes.blog_default_imageUrl="".concat(i().forum.attribute("baseUrl"),"/assets/").concat(i().data.settings.blog_default_image_path)}content(){const t=i().data.settings.blog_tags?i().data.settings.blog_tags.split("|").length:0;return m("div",{className:"BasicsPage FlarumBlog"},m("div",{className:"container"},m("div",{className:"FlarumBlog-SelectCategories"},0===t?i().translator.trans("v17development-flarum-blog.admin.settings.no_categories_selected"):i().translator.trans("v17development-flarum-blog.admin.settings.selected_category_count",{count:t}),m(v(),{className:"Button",onclick:()=>i().modal.show(N)},i().translator.trans("v17development-flarum-blog.admin.settings.select_categories_button"))),f().component({label:i().translator.trans("v17development-flarum-blog.admin.settings.blog_heading")},[x().component({state:1==this.allowComments,onchange:t=>{this.allowComments=t,this.hasChanges=!0}},[m("b",null,i().translator.trans("v17development-flarum-blog.admin.settings.allow_comments_label")),m("div",{className:"helpText"},i().translator.trans("v17development-flarum-blog.admin.settings.allow_comments_text"))]),x().component({state:1==this.requiresReviewOnPost,onchange:t=>{this.requiresReviewOnPost=t,this.hasChanges=!0}},[m("b",null,i().translator.trans("v17development-flarum-blog.admin.settings.require_review_label")),m("div",{className:"helpText"},i().translator.trans("v17development-flarum-blog.admin.settings.require_review_text"))]),x().component({state:1==this.hideOnDiscussionList,onchange:t=>{this.hideOnDiscussionList=t,this.hasChanges=!0}},[m("b",null,i().translator.trans("v17development-flarum-blog.admin.settings.hide_on_discussion_list_label")),m("div",{className:"helpText"},i().translator.trans("v17development-flarum-blog.admin.settings.hide_on_discussion_list_text"))]),x().component({state:1==this.addSidebarNav,onchange:t=>{this.addSidebarNav=t,this.hasChanges=!0}},[m("b",null,i().translator.trans("v17development-flarum-blog.admin.settings.add_sidebar_nav_label")),m("div",{className:"helpText"},i().translator.trans("v17development-flarum-blog.admin.settings.add_sidebar_nav_text"))]),x().component({state:1==this.blogAddHero,onchange:t=>{this.blogAddHero=t,this.hasChanges=!0}},[m("b",null,i().translator.trans("v17development-flarum-blog.admin.settings.add_hero_label")),m("div",{className:"helpText"},i().translator.trans("v17development-flarum-blog.admin.settings.add_hero_text"))]),m("div",{className:"Form-group"},m("label",null,i().translator.trans("v17development-flarum-blog.admin.settings.featured_count_label")),m("div",{className:"helpText"},i().translator.trans("v17development-flarum-blog.admin.settings.featured_count_text")),m("input",{class:"FormControl",value:this.featuredCount,oninput:t=>{this.featuredCount=t.target.value,this.hasChanges=!0},placeholder:"3",type:"number"}))]),f().component({label:i().translator.trans("v17development-flarum-blog.admin.settings.categories_heading")},[x().component({state:1==this.hideTagsInList,onchange:t=>{this.hideTagsInList=t,this.hasChanges=!0}},[m("b",null,i().translator.trans("v17development-flarum-blog.admin.settings.hide_tags_in_taglist_label")),m("div",{className:"helpText"},i().translator.trans("v17development-flarum-blog.admin.settings.hide_tags_in_taglist_text"))]),x().component({state:1==this.addCategoryHierarchy,onchange:t=>{this.addCategoryHierarchy=t,this.hasChanges=!0}},[m("b",null,i().translator.trans("v17development-flarum-blog.admin.settings.show_tag_hierarchy_label")),m("div",{className:"helpText"},i().translator.trans("v17development-flarum-blog.admin.settings.show_tag_hierarchy_text"))])]),f().component({label:i().translator.trans("v17development-flarum-blog.admin.settings.redirects_heading")},[x().component({state:"both"===this.redirectsEnabled||"discussions_only"===this.redirectsEnabled,onchange:t=>{t?"tags_only"===this.redirectsEnabled?this.redirectsEnabled="both":"none"===this.redirectsEnabled&&(this.redirectsEnabled="discussions_only"):"discussions_only"===this.redirectsEnabled?this.redirectsEnabled="none":this.redirectsEnabled="tags_only",this.hasChanges=!0}},[m("b",null,i().translator.trans("v17development-flarum-blog.admin.settings.redirect_articles_label")),m("div",{className:"helpText"},i().translator.trans("v17development-flarum-blog.admin.settings.redirect_articles_text"))]),x().component({state:"both"===this.redirectsEnabled||"tags_only"===this.redirectsEnabled,onchange:t=>{t?"discussions_only"===this.redirectsEnabled?this.redirectsEnabled="both":"none"===this.redirectsEnabled&&(this.redirectsEnabled="tags_only"):"tags_only"===this.redirectsEnabled?this.redirectsEnabled="none":this.redirectsEnabled="discussions_only",this.hasChanges=!0}},[m("b",null,i().translator.trans("v17development-flarum-blog.admin.settings.redirect_tags_label")),m("div",{className:"helpText"},i().translator.trans("v17development-flarum-blog.admin.settings.redirect_tags_text"))])]),f().component({label:i().translator.trans("v17development-flarum-blog.admin.settings.default_article_image_label")},[m("div",{className:"helpText"},i().translator.trans("v17development-flarum-blog.admin.settings.default_article_image_text")),E().component({name:"blog_default_image"})]),m(v(),{loading:this.isSaving,className:"Button Button--primary",onclick:()=>this.save(),disabled:!this.hasChanges},i().translator.trans("core.admin.settings.submit_button"))))}save(){this.isSaving=!0,h()({blog_add_sidebar_nav:this.addSidebarNav,blog_redirects_enabled:this.redirectsEnabled,blog_hide_tags:this.hideTagsInList,blog_requires_review:this.requiresReviewOnPost,blog_allow_comments:this.allowComments,blog_category_hierarchy:this.addCategoryHierarchy,blog_filter_discussion_list:this.hideOnDiscussionList,blog_featured_count:this.featuredCount,blog_add_hero:this.blogAddHero}).then((()=>{this.hasChanges=!1,i().alerts.show(b(),{type:"success"},i().translator.trans("core.admin.settings.saved_message"))})).catch((()=>{})).then((()=>{this.isSaving=!1,m.redraw()}))}}flarum.reg.add("vadkuz-flarum2-blog","admin/pages/BlogSettings",P),app.initializers.add("vadkuz-flarum2-blog",(()=>{app.extensionData.for("vadkuz-flarum2-blog").registerPage(P),app.extensionData.for("vadkuz-flarum2-blog").registerPermission({icon:"fas fa-pencil-alt",label:app.translator.trans("v17development-flarum-blog.admin.permissions.write_articles"),permission:"blog.writeArticles"},"blog",90).registerPermission({icon:"far fa-star",label:app.translator.trans("v17development-flarum-blog.admin.permissions.auto_approve_posts"),permission:"blog.autoApprovePosts"},"blog",90).registerPermission({icon:"far fa-thumbs-up",label:app.translator.trans("v17development-flarum-blog.admin.permissions.approve_posts"),permission:"blog.canApprovePosts"},"blog",90),(0,a.extend)(o().prototype,"permissionItems",(function(t){t.add("blog",{label:app.translator.trans("v17development-flarum-blog.admin.blog"),children:this.attrs.extensionId?app.extensionData.getExtensionPermissions(this.extensionId,"blog").toArray():app.extensionData.getAllExtensionPermissions("blog").toArray()},80)})),(0,a.extend)(n().prototype,"homePageItems",(t=>{t.add("blog",{path:"/blog",label:app.translator.trans("v17development-flarum-blog.admin.blog")})}))}))})(),module.exports=e})();
//# sourceMappingURL=admin.js.map