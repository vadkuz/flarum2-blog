(()=>{var t={n:a=>{var e=a&&a.__esModule?()=>a.default:()=>a;return t.d(e,{a:e}),e},d:(a,e)=>{for(var s in e)t.o(e,s)&&!t.o(a,s)&&Object.defineProperty(a,s,{enumerable:!0,get:e[s]})},o:(t,a)=>Object.prototype.hasOwnProperty.call(t,a),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},a={};(()=>{"use strict";t.r(a);const e=flarum.reg.get("core","common/extend"),s=flarum.reg.get("core","admin/components/BasicsPage");var n=t.n(s);const l=flarum.reg.get("core","admin/components/PermissionGrid");var r=t.n(l);const i=flarum.reg.get("core","admin/app");var o=t.n(i);const d=flarum.reg.get("core","admin/components/ExtensionPage");var g=t.n(d);const u=flarum.reg.get("core","admin/utils/saveSettings");var c=t.n(u);const h=flarum.reg.get("core","common/components/Alert");var b=t.n(h);const p=flarum.reg.get("core","common/components/Button");var _=t.n(p);const v=flarum.reg.get("core","common/components/FieldSet");var f=t.n(v);const y=flarum.reg.get("core","common/components/Switch");var k=t.n(y);const x=flarum.reg.get("core","common/components/Modal");var C=t.n(x);class z extends(C()){oninit(t){super.oninit(t),this.blogCategoriesOriginal=app.data.settings.blog_tags?app.data.settings.blog_tags.split("|"):[],this.blogCategories=app.data.settings.blog_tags?app.data.settings.blog_tags.split("|"):[],this.isSaving=!1,this.hasChanges=!1}title(){return"Select blog categories"}className(){return"Modal modal-dialog FlarumBlog-TagsModal"}content(){return m("div",null,m("div",{className:"Modal-body"},m("p",null,"Please select one or more tags that are considered blog tags."," ",m("a",{href:app.forum.attribute("baseUrl")+"/blog",target:"_blank"},"Visit your blog.")),m("table",{className:"FlarumBlog-TagsTable"},m("thead",null,m("th",{width:"35"}),m("th",null,"Tag name"),m("th",{width:"50"})),m("tbody",null,0===app.store.all("tags").length&&m("tr",null,m("td",{colspan:"3"},"You currently have no tags.")),app.store.all("tags").map((t=>{if(t.parent())return;const a=()=>{const a=this.blogCategories.indexOf(t.id());this.hasChanges=!0,a>=0?this.blogCategories.splice(a,1):this.blogCategories.push(t.id())};return m("tr",null,m("td",null,m("i",{className:t.icon()})),m("td",{onclick:a},t.name()),m("td",null,m(k(),{state:this.blogCategories.indexOf(t.id())>=0,onchange:a})))}))))),m("div",{style:"padding: 25px 30px; text-align: center;"},m(_(),{type:"submit",className:"Button Button--primary",loading:this.loading},this.hasChanges?"Save changes":"Close")))}onsubmit(t){if(t.preventDefault(),!this.hasChanges)return void this.hide();this.isSaving=!0;let a=[];this.blogCategories.map((t=>{app.store.getById("tags",t)&&a.push(t)})),c()({blog_tags:a.join("|")}).then((()=>{app.alerts.show(b(),{type:"success"},app.translator.trans("core.admin.settings.saved_message")),this.hide()})).catch((()=>{app.alerts.show(b(),{type:"error"},app.translator.trans("core.lib.error.generic_message"))})).then((()=>{this.isSaving=!1}))}}flarum.reg.add("vadkuz-flarum2-blog","admin/components/Modals/SelectCategoriesModal",z);const w=flarum.reg.get("core","admin/components/UploadImageButton");var N=t.n(w);class S extends(g()){oninit(t){var a,e,s,n,l,r,i,d,g;super.oninit(t),this.hasChanges=!1,this.isSaving=!1,this.redirectsEnabled=null!=(a=o().data.settings.blog_redirects_enabled)?a:"both",this.hideTagsInList=null==(e=o().data.settings.blog_hide_tags)||e,this.allowComments=null==(s=o().data.settings.blog_allow_comments)||s,this.hideOnDiscussionList=null!=(n=o().data.settings.blog_filter_discussion_list)&&n,this.requiresReviewOnPost=null!=(l=o().data.settings.blog_requires_review)&&l,this.addCategoryHierarchy=null==(r=o().data.settings.blog_category_hierarchy)||r,this.addSidebarNav=null==(i=o().data.settings.blog_add_sidebar_nav)||i,this.featuredCount=null!=(d=o().data.settings.blog_featured_count)?d:3,this.blogAddHero=null==(g=o().data.settings.blog_add_hero)||g,o().forum.data.attributes.blog_default_imageUrl="".concat(o().forum.attribute("baseUrl"),"/assets/").concat(o().data.settings.blog_default_image_path)}content(){const t=o().data.settings.blog_tags?o().data.settings.blog_tags.split("|").length:0;return m("div",{className:"BasicsPage FlarumBlog"},m("div",{className:"container"},m("div",{className:"FlarumBlog-SelectCategories"},0===t?o().translator.trans("vadkuz-flarum2-blog.admin.settings.no_categories_selected"):o().translator.trans("vadkuz-flarum2-blog.admin.settings.selected_category_count",{count:t}),m(_(),{className:"Button",onclick:()=>o().modal.show(z)},o().translator.trans("vadkuz-flarum2-blog.admin.settings.select_categories_button"))),f().component({label:o().translator.trans("vadkuz-flarum2-blog.admin.settings.blog_heading")},[k().component({state:1==this.allowComments,onchange:t=>{this.allowComments=t,this.hasChanges=!0}},[m("b",null,o().translator.trans("vadkuz-flarum2-blog.admin.settings.allow_comments_label")),m("div",{className:"helpText"},o().translator.trans("vadkuz-flarum2-blog.admin.settings.allow_comments_text"))]),k().component({state:1==this.requiresReviewOnPost,onchange:t=>{this.requiresReviewOnPost=t,this.hasChanges=!0}},[m("b",null,o().translator.trans("vadkuz-flarum2-blog.admin.settings.require_review_label")),m("div",{className:"helpText"},o().translator.trans("vadkuz-flarum2-blog.admin.settings.require_review_text"))]),k().component({state:1==this.hideOnDiscussionList,onchange:t=>{this.hideOnDiscussionList=t,this.hasChanges=!0}},[m("b",null,o().translator.trans("vadkuz-flarum2-blog.admin.settings.hide_on_discussion_list_label")),m("div",{className:"helpText"},o().translator.trans("vadkuz-flarum2-blog.admin.settings.hide_on_discussion_list_text"))]),k().component({state:1==this.addSidebarNav,onchange:t=>{this.addSidebarNav=t,this.hasChanges=!0}},[m("b",null,o().translator.trans("vadkuz-flarum2-blog.admin.settings.add_sidebar_nav_label")),m("div",{className:"helpText"},o().translator.trans("vadkuz-flarum2-blog.admin.settings.add_sidebar_nav_text"))]),k().component({state:1==this.blogAddHero,onchange:t=>{this.blogAddHero=t,this.hasChanges=!0}},[m("b",null,o().translator.trans("vadkuz-flarum2-blog.admin.settings.add_hero_label")),m("div",{className:"helpText"},o().translator.trans("vadkuz-flarum2-blog.admin.settings.add_hero_text"))]),m("div",{className:"Form-group"},m("label",null,o().translator.trans("vadkuz-flarum2-blog.admin.settings.featured_count_label")),m("div",{className:"helpText"},o().translator.trans("vadkuz-flarum2-blog.admin.settings.featured_count_text")),m("input",{class:"FormControl",value:this.featuredCount,oninput:t=>{this.featuredCount=t.target.value,this.hasChanges=!0},placeholder:"3",type:"number"}))]),f().component({label:o().translator.trans("vadkuz-flarum2-blog.admin.settings.categories_heading")},[k().component({state:1==this.hideTagsInList,onchange:t=>{this.hideTagsInList=t,this.hasChanges=!0}},[m("b",null,o().translator.trans("vadkuz-flarum2-blog.admin.settings.hide_tags_in_taglist_label")),m("div",{className:"helpText"},o().translator.trans("vadkuz-flarum2-blog.admin.settings.hide_tags_in_taglist_text"))]),k().component({state:1==this.addCategoryHierarchy,onchange:t=>{this.addCategoryHierarchy=t,this.hasChanges=!0}},[m("b",null,o().translator.trans("vadkuz-flarum2-blog.admin.settings.show_tag_hierarchy_label")),m("div",{className:"helpText"},o().translator.trans("vadkuz-flarum2-blog.admin.settings.show_tag_hierarchy_text"))])]),f().component({label:o().translator.trans("vadkuz-flarum2-blog.admin.settings.redirects_heading")},[k().component({state:"both"===this.redirectsEnabled||"discussions_only"===this.redirectsEnabled,onchange:t=>{t?"tags_only"===this.redirectsEnabled?this.redirectsEnabled="both":"none"===this.redirectsEnabled&&(this.redirectsEnabled="discussions_only"):"discussions_only"===this.redirectsEnabled?this.redirectsEnabled="none":this.redirectsEnabled="tags_only",this.hasChanges=!0}},[m("b",null,o().translator.trans("vadkuz-flarum2-blog.admin.settings.redirect_articles_label")),m("div",{className:"helpText"},o().translator.trans("vadkuz-flarum2-blog.admin.settings.redirect_articles_text"))]),k().component({state:"both"===this.redirectsEnabled||"tags_only"===this.redirectsEnabled,onchange:t=>{t?"discussions_only"===this.redirectsEnabled?this.redirectsEnabled="both":"none"===this.redirectsEnabled&&(this.redirectsEnabled="tags_only"):"tags_only"===this.redirectsEnabled?this.redirectsEnabled="none":this.redirectsEnabled="discussions_only",this.hasChanges=!0}},[m("b",null,o().translator.trans("vadkuz-flarum2-blog.admin.settings.redirect_tags_label")),m("div",{className:"helpText"},o().translator.trans("vadkuz-flarum2-blog.admin.settings.redirect_tags_text"))])]),f().component({label:o().translator.trans("vadkuz-flarum2-blog.admin.settings.default_article_image_label")},[m("div",{className:"helpText"},o().translator.trans("vadkuz-flarum2-blog.admin.settings.default_article_image_text")),N().component({name:"blog_default_image"})]),m(_(),{loading:this.isSaving,className:"Button Button--primary",onclick:()=>this.save(),disabled:!this.hasChanges},o().translator.trans("core.admin.settings.submit_button"))))}save(){this.isSaving=!0,c()({blog_add_sidebar_nav:this.addSidebarNav,blog_redirects_enabled:this.redirectsEnabled,blog_hide_tags:this.hideTagsInList,blog_requires_review:this.requiresReviewOnPost,blog_allow_comments:this.allowComments,blog_category_hierarchy:this.addCategoryHierarchy,blog_filter_discussion_list:this.hideOnDiscussionList,blog_featured_count:this.featuredCount,blog_add_hero:this.blogAddHero}).then((()=>{this.hasChanges=!1,o().alerts.show(b(),{type:"success"},o().translator.trans("core.admin.settings.saved_message"))})).catch((()=>{})).then((()=>{this.isSaving=!1,m.redraw()}))}}flarum.reg.add("vadkuz-flarum2-blog","admin/pages/BlogSettings",S),app.initializers.add("vadkuz-flarum2-blog",(()=>{app.extensionData.for("vadkuz-flarum2-blog").registerPage(S),app.extensionData.for("vadkuz-flarum2-blog").registerPermission({icon:"fas fa-pencil-alt",label:app.translator.trans("vadkuz-flarum2-blog.admin.permissions.write_articles"),permission:"blog.writeArticles"},"blog",90).registerPermission({icon:"far fa-star",label:app.translator.trans("vadkuz-flarum2-blog.admin.permissions.auto_approve_posts"),permission:"blog.autoApprovePosts"},"blog",90).registerPermission({icon:"far fa-thumbs-up",label:app.translator.trans("vadkuz-flarum2-blog.admin.permissions.approve_posts"),permission:"blog.canApprovePosts"},"blog",90),(0,e.extend)(r().prototype,"permissionItems",(function(t){var a,e,s,n;const l=null==(a=this.attrs)?void 0:a.extensionId,r=l?null!=(e=null==(s=app.extensionData.getExtensionPermissions(l,"blog"))||null==(n=s.toArray)?void 0:n.call(s))?e:[]:app.extensionData.getAllExtensionPermissions("blog").toArray();t.add("blog",{label:app.translator.trans("vadkuz-flarum2-blog.admin.blog"),children:r},80)})),(0,e.extend)(n().prototype,"homePageItems",(t=>{t.add("blog",{path:"/blog",label:app.translator.trans("vadkuz-flarum2-blog.admin.blog")})}))}))})(),module.exports=a})();
//# sourceMappingURL=admin.js.map