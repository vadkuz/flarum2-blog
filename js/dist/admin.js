(()=>{var t={n:a=>{var e=a&&a.__esModule?()=>a.default:()=>a;return t.d(e,{a:e}),e},d:(a,e)=>{for(var s in e)t.o(e,s)&&!t.o(a,s)&&Object.defineProperty(a,s,{enumerable:!0,get:e[s]})},o:(t,a)=>Object.prototype.hasOwnProperty.call(t,a),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},a={};(()=>{"use strict";t.r(a);const e=flarum.reg.get("core","common/extend"),s=flarum.reg.get("core","admin/app");var n=t.n(s);const l=flarum.reg.get("core","admin/components/BasicsPage");var r=t.n(l);const i=flarum.reg.get("core","admin/components/PermissionGrid");var o=t.n(i);const d=flarum.reg.get("core","admin/components/ExtensionPage");var g=t.n(d);const u=flarum.reg.get("core","admin/utils/saveSettings");var c=t.n(u);const h=flarum.reg.get("core","common/components/Alert");var b=t.n(h);const _=flarum.reg.get("core","common/components/Button");var p=t.n(_);const v=flarum.reg.get("core","common/components/FieldSet");var f=t.n(v);const y=flarum.reg.get("core","common/components/Switch");var k=t.n(y);const C=flarum.reg.get("core","common/components/UploadImageButton");var z=t.n(C);const x=flarum.reg.get("core","common/components/Modal");var w=t.n(x);class N extends(w()){oninit(t){super.oninit(t),this.blogCategoriesOriginal=app.data.settings.blog_tags?app.data.settings.blog_tags.split("|"):[],this.blogCategories=app.data.settings.blog_tags?app.data.settings.blog_tags.split("|"):[],this.isSaving=!1,this.hasChanges=!1}title(){return"Select blog categories"}className(){return"Modal modal-dialog FlarumBlog-TagsModal"}content(){return m("div",null,m("div",{className:"Modal-body"},m("p",null,"Please select one or more tags that are considered blog tags."," ",m("a",{href:app.forum.attribute("baseUrl")+"/blog",target:"_blank"},"Visit your blog.")),m("table",{className:"FlarumBlog-TagsTable"},m("thead",null,m("th",{width:"35"}),m("th",null,"Tag name"),m("th",{width:"50"})),m("tbody",null,0===app.store.all("tags").length&&m("tr",null,m("td",{colspan:"3"},"You currently have no tags.")),app.store.all("tags").map((t=>{if(t.parent())return;const a=()=>{const a=this.blogCategories.indexOf(t.id());this.hasChanges=!0,a>=0?this.blogCategories.splice(a,1):this.blogCategories.push(t.id())};return m("tr",null,m("td",null,m("i",{className:t.icon()})),m("td",{onclick:a},t.name()),m("td",null,m(k(),{state:this.blogCategories.indexOf(t.id())>=0,onchange:a})))}))))),m("div",{style:"padding: 25px 30px; text-align: center;"},m(p(),{type:"submit",className:"Button Button--primary",loading:this.loading},this.hasChanges?"Save changes":"Close")))}onsubmit(t){if(t.preventDefault(),!this.hasChanges)return void this.hide();this.isSaving=!0;let a=[];this.blogCategories.map((t=>{app.store.getById("tags",t)&&a.push(t)})),c()({blog_tags:a.join("|")}).then((()=>{app.alerts.show(b(),{type:"success"},app.translator.trans("core.admin.settings.saved_message")),this.hide()})).catch((()=>{app.alerts.show(b(),{type:"error"},app.translator.trans("core.lib.error.generic_message"))})).then((()=>{this.isSaving=!1}))}}flarum.reg.add("vadkuz-flarum2-blog","admin/components/Modals/SelectCategoriesModal",N);class S extends(g()){oninit(t){var a,e,s,l,r,i,o,d,g,m;super.oninit(t),this.hasChanges=!1,this.isSaving=!1,this.redirectsEnabled=null!=(a=n().data.settings.blog_redirects_enabled)?a:"both",this.hideTagsInList=null==(e=n().data.settings.blog_hide_tags)||e,this.allowComments=null==(s=n().data.settings.blog_allow_comments)||s,this.hideOnDiscussionList=null!=(l=n().data.settings.blog_filter_discussion_list)&&l,this.requiresReviewOnPost=null!=(r=n().data.settings.blog_requires_review)&&r,this.addCategoryHierarchy=null==(i=n().data.settings.blog_category_hierarchy)||i,this.addSidebarNav=null==(o=n().data.settings.blog_add_sidebar_nav)||o,this.featuredCount=null!=(d=n().data.settings.blog_featured_count)?d:3,this.blogAddHero=null==(g=n().data.settings.blog_add_hero)||g;const u=null!=(m=n().data.settings.blog_default_image_path)?m:null;n().forum.data.attributes.blog_default_imageUrl=u?"".concat(n().forum.attribute("baseUrl"),"/assets/").concat(u):null}content(){const t=n().data.settings.blog_tags?n().data.settings.blog_tags.split("|").length:0;return m("div",{className:"BasicsPage FlarumBlog"},m("div",{className:"container"},m("div",{className:"FlarumBlog-SelectCategories"},0===t?n().translator.trans("vadkuz-flarum2-blog.admin.settings.no_categories_selected"):n().translator.trans("vadkuz-flarum2-blog.admin.settings.selected_category_count",{count:t}),m(p(),{className:"Button",onclick:()=>n().modal.show(N)},n().translator.trans("vadkuz-flarum2-blog.admin.settings.select_categories_button"))),f().component({label:n().translator.trans("vadkuz-flarum2-blog.admin.settings.blog_heading")},[k().component({state:1==this.allowComments,onchange:t=>{this.allowComments=t,this.hasChanges=!0}},[m("b",null,n().translator.trans("vadkuz-flarum2-blog.admin.settings.allow_comments_label")),m("div",{className:"helpText"},n().translator.trans("vadkuz-flarum2-blog.admin.settings.allow_comments_text"))]),k().component({state:1==this.requiresReviewOnPost,onchange:t=>{this.requiresReviewOnPost=t,this.hasChanges=!0}},[m("b",null,n().translator.trans("vadkuz-flarum2-blog.admin.settings.require_review_label")),m("div",{className:"helpText"},n().translator.trans("vadkuz-flarum2-blog.admin.settings.require_review_text"))]),k().component({state:1==this.hideOnDiscussionList,onchange:t=>{this.hideOnDiscussionList=t,this.hasChanges=!0}},[m("b",null,n().translator.trans("vadkuz-flarum2-blog.admin.settings.hide_on_discussion_list_label")),m("div",{className:"helpText"},n().translator.trans("vadkuz-flarum2-blog.admin.settings.hide_on_discussion_list_text"))]),k().component({state:1==this.addSidebarNav,onchange:t=>{this.addSidebarNav=t,this.hasChanges=!0}},[m("b",null,n().translator.trans("vadkuz-flarum2-blog.admin.settings.add_sidebar_nav_label")),m("div",{className:"helpText"},n().translator.trans("vadkuz-flarum2-blog.admin.settings.add_sidebar_nav_text"))]),k().component({state:1==this.blogAddHero,onchange:t=>{this.blogAddHero=t,this.hasChanges=!0}},[m("b",null,n().translator.trans("vadkuz-flarum2-blog.admin.settings.add_hero_label")),m("div",{className:"helpText"},n().translator.trans("vadkuz-flarum2-blog.admin.settings.add_hero_text"))]),m("div",{className:"Form-group"},m("label",null,n().translator.trans("vadkuz-flarum2-blog.admin.settings.featured_count_label")),m("div",{className:"helpText"},n().translator.trans("vadkuz-flarum2-blog.admin.settings.featured_count_text")),m("input",{class:"FormControl",value:this.featuredCount,oninput:t=>{this.featuredCount=t.target.value,this.hasChanges=!0},placeholder:"3",type:"number"}))]),f().component({label:n().translator.trans("vadkuz-flarum2-blog.admin.settings.categories_heading")},[k().component({state:1==this.hideTagsInList,onchange:t=>{this.hideTagsInList=t,this.hasChanges=!0}},[m("b",null,n().translator.trans("vadkuz-flarum2-blog.admin.settings.hide_tags_in_taglist_label")),m("div",{className:"helpText"},n().translator.trans("vadkuz-flarum2-blog.admin.settings.hide_tags_in_taglist_text"))]),k().component({state:1==this.addCategoryHierarchy,onchange:t=>{this.addCategoryHierarchy=t,this.hasChanges=!0}},[m("b",null,n().translator.trans("vadkuz-flarum2-blog.admin.settings.show_tag_hierarchy_label")),m("div",{className:"helpText"},n().translator.trans("vadkuz-flarum2-blog.admin.settings.show_tag_hierarchy_text"))])]),f().component({label:n().translator.trans("vadkuz-flarum2-blog.admin.settings.redirects_heading")},[k().component({state:"both"===this.redirectsEnabled||"discussions_only"===this.redirectsEnabled,onchange:t=>{t?"tags_only"===this.redirectsEnabled?this.redirectsEnabled="both":"none"===this.redirectsEnabled&&(this.redirectsEnabled="discussions_only"):"discussions_only"===this.redirectsEnabled?this.redirectsEnabled="none":this.redirectsEnabled="tags_only",this.hasChanges=!0}},[m("b",null,n().translator.trans("vadkuz-flarum2-blog.admin.settings.redirect_articles_label")),m("div",{className:"helpText"},n().translator.trans("vadkuz-flarum2-blog.admin.settings.redirect_articles_text"))]),k().component({state:"both"===this.redirectsEnabled||"tags_only"===this.redirectsEnabled,onchange:t=>{t?"discussions_only"===this.redirectsEnabled?this.redirectsEnabled="both":"none"===this.redirectsEnabled&&(this.redirectsEnabled="tags_only"):"tags_only"===this.redirectsEnabled?this.redirectsEnabled="none":this.redirectsEnabled="discussions_only",this.hasChanges=!0}},[m("b",null,n().translator.trans("vadkuz-flarum2-blog.admin.settings.redirect_tags_label")),m("div",{className:"helpText"},n().translator.trans("vadkuz-flarum2-blog.admin.settings.redirect_tags_text"))])]),f().component({label:n().translator.trans("vadkuz-flarum2-blog.admin.settings.default_article_image_label")},[m("div",{className:"helpText"},n().translator.trans("vadkuz-flarum2-blog.admin.settings.default_article_image_text")),z().component({name:"blog_default_image",routePath:"blog_default_image",value:()=>{var t;return null!=(t=n().data.settings.blog_default_image_path)?t:null},url:()=>{var t;return null!=(t=n().forum.attribute("blog_default_imageUrl"))?t:null}})]),m(p(),{loading:this.isSaving,className:"Button Button--primary",onclick:()=>this.save(),disabled:!this.hasChanges},n().translator.trans("core.admin.settings.submit_button"))))}save(){this.isSaving=!0,c()({blog_add_sidebar_nav:this.addSidebarNav,blog_redirects_enabled:this.redirectsEnabled,blog_hide_tags:this.hideTagsInList,blog_requires_review:this.requiresReviewOnPost,blog_allow_comments:this.allowComments,blog_category_hierarchy:this.addCategoryHierarchy,blog_filter_discussion_list:this.hideOnDiscussionList,blog_featured_count:this.featuredCount,blog_add_hero:this.blogAddHero}).then((()=>{this.hasChanges=!1,n().alerts.show(b(),{type:"success"},n().translator.trans("core.admin.settings.saved_message"))})).catch((()=>{})).then((()=>{this.isSaving=!1,m.redraw()}))}}flarum.reg.add("vadkuz-flarum2-blog","admin/pages/BlogSettings",S),n().initializers.add("vadkuz-flarum2-blog",(()=>{n().registry.for("vadkuz-flarum2-blog").registerPage(S),n().registry.for("vadkuz-flarum2-blog").registerPermission({icon:"fas fa-pencil-alt",label:n().translator.trans("vadkuz-flarum2-blog.admin.permissions.write_articles"),permission:"blog.writeArticles"},"blog",90).registerPermission({icon:"far fa-star",label:n().translator.trans("vadkuz-flarum2-blog.admin.permissions.auto_approve_posts"),permission:"blog.autoApprovePosts"},"blog",90).registerPermission({icon:"far fa-thumbs-up",label:n().translator.trans("vadkuz-flarum2-blog.admin.permissions.approve_posts"),permission:"blog.canApprovePosts"},"blog",90),(0,e.extend)(o().prototype,"permissionItems",(function(t){var a,e,s,l;const r=null==(a=this.attrs)?void 0:a.extensionId,i=r?null!=(e=null==(s=n().registry.getExtensionPermissions(r,"blog"))||null==(l=s.toArray)?void 0:l.call(s))?e:[]:n().registry.getAllPermissions("blog").toArray();t.add("blog",{label:n().translator.trans("vadkuz-flarum2-blog.admin.blog"),children:i},80)})),(0,e.extend)(r().prototype,"homePageItems",(t=>{t.add("blog",{path:"/blog",label:n().translator.trans("vadkuz-flarum2-blog.admin.blog")})}))}))})(),module.exports=a})();
//# sourceMappingURL=admin.js.map