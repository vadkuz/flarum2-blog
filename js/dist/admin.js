(()=>{var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var s in a)e.o(a,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:a[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{"use strict";e.r(t);const a=flarum.reg.get("core","common/extend"),s=flarum.reg.get("core","admin/components/BasicsPage");var n=e.n(s);const l=flarum.reg.get("core","admin/components/PermissionGrid");var o=e.n(l);const i=flarum.reg.get("core","admin/app");var r=e.n(i);const d=flarum.reg.get("core","admin/components/ExtensionPage");var g=e.n(d);const c=flarum.reg.get("core","admin/utils/saveSettings");var h=e.n(c);const b=flarum.reg.get("core","common/components/Alert");var p=e.n(b);const u=flarum.reg.get("core","common/components/Button");var v=e.n(u);const _=flarum.reg.get("core","common/components/FieldSet");var f=e.n(_);const y=flarum.reg.get("core","common/components/Switch");var x=e.n(y);const C=flarum.reg.get("core","common/components/Modal");var w=e.n(C);class N extends(w()){oninit(e){super.oninit(e),this.blogCategoriesOriginal=app.data.settings.blog_tags?app.data.settings.blog_tags.split("|"):[],this.blogCategories=app.data.settings.blog_tags?app.data.settings.blog_tags.split("|"):[],this.isSaving=!1,this.hasChanges=!1}title(){return"Select blog categories"}className(){return"Modal modal-dialog FlarumBlog-TagsModal"}content(){return m("div",null,m("div",{className:"Modal-body"},m("p",null,"Please select one or more tags that are considered blog tags."," ",m("a",{href:app.forum.attribute("baseUrl")+"/blog",target:"_blank"},"Visit your blog.")),m("table",{className:"FlarumBlog-TagsTable"},m("thead",null,m("th",{width:"35"}),m("th",null,"Tag name"),m("th",{width:"50"})),m("tbody",null,0===app.store.all("tags").length&&m("tr",null,m("td",{colspan:"3"},"You currently have no tags.")),app.store.all("tags").map((e=>{if(e.parent())return;const t=()=>{const t=this.blogCategories.indexOf(e.id());this.hasChanges=!0,t>=0?this.blogCategories.splice(t,1):this.blogCategories.push(e.id())};return m("tr",null,m("td",null,m("i",{className:e.icon()})),m("td",{onclick:t},e.name()),m("td",null,m(x(),{state:this.blogCategories.indexOf(e.id())>=0,onchange:t})))}))))),m("div",{style:"padding: 25px 30px; text-align: center;"},m(v(),{type:"submit",className:"Button Button--primary",loading:this.loading},this.hasChanges?"Save changes":"Close")))}onsubmit(e){if(e.preventDefault(),!this.hasChanges)return void this.hide();this.isSaving=!0;let t=[];this.blogCategories.map((e=>{app.store.getById("tags",e)&&t.push(e)})),h()({blog_tags:t.join("|")}).then((()=>{app.alerts.show(p(),{type:"success"},app.translator.trans("core.admin.settings.saved_message")),this.hide()})).catch((()=>{app.alerts.show(p(),{type:"error"},app.translator.trans("core.lib.error.generic_message"))})).then((()=>{this.isSaving=!1}))}}flarum.reg.add("v17development-blog","admin/components/Modals/SelectCategoriesModal",N);const S=flarum.reg.get("core","admin/components/UploadImageButton");var E=e.n(S);class P extends(g()){oninit(e){var t,a,s,n,l,o,i,d,g;super.oninit(e),this.hasChanges=!1,this.isSaving=!1,this.redirectsEnabled=null!=(t=r().data.settings.blog_redirects_enabled)?t:"both",this.hideTagsInList=null==(a=r().data.settings.blog_hide_tags)||a,this.allowComments=null==(s=r().data.settings.blog_allow_comments)||s,this.hideOnDiscussionList=null!=(n=r().data.settings.blog_filter_discussion_list)&&n,this.requiresReviewOnPost=null!=(l=r().data.settings.blog_requires_review)&&l,this.addCategoryHierarchy=null==(o=r().data.settings.blog_category_hierarchy)||o,this.addSidebarNav=null==(i=r().data.settings.blog_add_sidebar_nav)||i,this.featuredCount=null!=(d=r().data.settings.blog_featured_count)?d:3,this.blogAddHero=null==(g=r().data.settings.blog_add_hero)||g,r().forum.data.attributes.blog_default_imageUrl="".concat(r().forum.attribute("baseUrl"),"/assets/").concat(r().data.settings.blog_default_image_path)}content(){const e=r().data.settings.blog_tags?r().data.settings.blog_tags.split("|").length:0;return m("div",{className:"BasicsPage FlarumBlog"},m("div",{className:"container"},m("div",{className:"FlarumBlog-SelectCategories"},0===e?r().translator.trans("v17development-flarum-blog.admin.settings.no_categories_selected"):r().translator.trans("v17development-flarum-blog.admin.settings.selected_category_count",{count:e}),m(v(),{className:"Button",onclick:()=>r().modal.show(N)},r().translator.trans("v17development-flarum-blog.admin.settings.select_categories_button"))),f().component({label:r().translator.trans("v17development-flarum-blog.admin.settings.blog_heading")},[x().component({state:1==this.allowComments,onchange:e=>{this.allowComments=e,this.hasChanges=!0}},[m("b",null,r().translator.trans("v17development-flarum-blog.admin.settings.allow_comments_label")),m("div",{className:"helpText"},r().translator.trans("v17development-flarum-blog.admin.settings.allow_comments_text"))]),x().component({state:1==this.requiresReviewOnPost,onchange:e=>{this.requiresReviewOnPost=e,this.hasChanges=!0}},[m("b",null,r().translator.trans("v17development-flarum-blog.admin.settings.require_review_label")),m("div",{className:"helpText"},r().translator.trans("v17development-flarum-blog.admin.settings.require_review_text"))]),x().component({state:1==this.hideOnDiscussionList,onchange:e=>{this.hideOnDiscussionList=e,this.hasChanges=!0}},[m("b",null,r().translator.trans("v17development-flarum-blog.admin.settings.hide_on_discussion_list_label")),m("div",{className:"helpText"},r().translator.trans("v17development-flarum-blog.admin.settings.hide_on_discussion_list_text"))]),x().component({state:1==this.addSidebarNav,onchange:e=>{this.addSidebarNav=e,this.hasChanges=!0}},[m("b",null,r().translator.trans("v17development-flarum-blog.admin.settings.add_sidebar_nav_label")),m("div",{className:"helpText"},r().translator.trans("v17development-flarum-blog.admin.settings.add_sidebar_nav_text"))]),x().component({state:1==this.blogAddHero,onchange:e=>{this.blogAddHero=e,this.hasChanges=!0}},[m("b",null,r().translator.trans("v17development-flarum-blog.admin.settings.add_hero_label")),m("div",{className:"helpText"},r().translator.trans("v17development-flarum-blog.admin.settings.add_hero_text"))]),m("div",{className:"Form-group"},m("label",null,r().translator.trans("v17development-flarum-blog.admin.settings.featured_count_label")),m("div",{className:"helpText"},r().translator.trans("v17development-flarum-blog.admin.settings.featured_count_text")),m("input",{class:"FormControl",value:this.featuredCount,oninput:e=>{this.featuredCount=e.target.value,this.hasChanges=!0},placeholder:"3",type:"number"}))]),f().component({label:r().translator.trans("v17development-flarum-blog.admin.settings.categories_heading")},[x().component({state:1==this.hideTagsInList,onchange:e=>{this.hideTagsInList=e,this.hasChanges=!0}},[m("b",null,r().translator.trans("v17development-flarum-blog.admin.settings.hide_tags_in_taglist_label")),m("div",{className:"helpText"},r().translator.trans("v17development-flarum-blog.admin.settings.hide_tags_in_taglist_text"))]),x().component({state:1==this.addCategoryHierarchy,onchange:e=>{this.addCategoryHierarchy=e,this.hasChanges=!0}},[m("b",null,r().translator.trans("v17development-flarum-blog.admin.settings.show_tag_hierarchy_label")),m("div",{className:"helpText"},r().translator.trans("v17development-flarum-blog.admin.settings.show_tag_hierarchy_text"))])]),f().component({label:r().translator.trans("v17development-flarum-blog.admin.settings.redirects_heading")},[x().component({state:"both"===this.redirectsEnabled||"discussions_only"===this.redirectsEnabled,onchange:e=>{e?"tags_only"===this.redirectsEnabled?this.redirectsEnabled="both":"none"===this.redirectsEnabled&&(this.redirectsEnabled="discussions_only"):"discussions_only"===this.redirectsEnabled?this.redirectsEnabled="none":this.redirectsEnabled="tags_only",this.hasChanges=!0}},[m("b",null,r().translator.trans("v17development-flarum-blog.admin.settings.redirect_articles_label")),m("div",{className:"helpText"},r().translator.trans("v17development-flarum-blog.admin.settings.redirect_articles_text"))]),x().component({state:"both"===this.redirectsEnabled||"tags_only"===this.redirectsEnabled,onchange:e=>{e?"discussions_only"===this.redirectsEnabled?this.redirectsEnabled="both":"none"===this.redirectsEnabled&&(this.redirectsEnabled="tags_only"):"tags_only"===this.redirectsEnabled?this.redirectsEnabled="none":this.redirectsEnabled="discussions_only",this.hasChanges=!0}},[m("b",null,r().translator.trans("v17development-flarum-blog.admin.settings.redirect_tags_label")),m("div",{className:"helpText"},r().translator.trans("v17development-flarum-blog.admin.settings.redirect_tags_text"))])]),f().component({label:r().translator.trans("v17development-flarum-blog.admin.settings.default_article_image_label")},[m("div",{className:"helpText"},r().translator.trans("v17development-flarum-blog.admin.settings.default_article_image_text")),E().component({name:"blog_default_image"})]),m(v(),{loading:this.isSaving,className:"Button Button--primary",onclick:()=>this.save(),disabled:!this.hasChanges},r().translator.trans("core.admin.settings.submit_button"))))}save(){this.isSaving=!0,h()({blog_add_sidebar_nav:this.addSidebarNav,blog_redirects_enabled:this.redirectsEnabled,blog_hide_tags:this.hideTagsInList,blog_requires_review:this.requiresReviewOnPost,blog_allow_comments:this.allowComments,blog_category_hierarchy:this.addCategoryHierarchy,blog_filter_discussion_list:this.hideOnDiscussionList,blog_featured_count:this.featuredCount,blog_add_hero:this.blogAddHero}).then((()=>{this.hasChanges=!1,r().alerts.show(p(),{type:"success"},r().translator.trans("core.admin.settings.saved_message"))})).catch((()=>{})).then((()=>{this.isSaving=!1,m.redraw()}))}}flarum.reg.add("v17development-blog","admin/pages/BlogSettings",P),app.initializers.add("v17development-flarum-blog",(()=>{app.extensionData.for("v17development-blog").registerPage(P),app.extensionData.for("v17development-blog").registerPermission({icon:"fas fa-pencil-alt",label:app.translator.trans("v17development-flarum-blog.admin.permissions.write_articles"),permission:"blog.writeArticles"},"blog",90).registerPermission({icon:"far fa-star",label:app.translator.trans("v17development-flarum-blog.admin.permissions.auto_approve_posts"),permission:"blog.autoApprovePosts"},"blog",90).registerPermission({icon:"far fa-thumbs-up",label:app.translator.trans("v17development-flarum-blog.admin.permissions.approve_posts"),permission:"blog.canApprovePosts"},"blog",90),(0,a.extend)(o().prototype,"permissionItems",(function(e){e.add("blog",{label:app.translator.trans("v17development-flarum-blog.admin.blog"),children:this.attrs.extensionId?app.extensionData.getExtensionPermissions(this.extensionId,"blog").toArray():app.extensionData.getAllExtensionPermissions("blog").toArray()},80)})),(0,a.extend)(n().prototype,"homePageItems",(e=>{e.add("blog",{path:"/blog",label:app.translator.trans("v17development-flarum-blog.admin.blog")})}))}))})(),module.exports=t})();
//# sourceMappingURL=admin.js.map