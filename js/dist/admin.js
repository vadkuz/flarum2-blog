(()=>{var t={n:a=>{var e=a&&a.__esModule?()=>a.default:()=>a;return t.d(e,{a:e}),e},d:(a,e)=>{for(var s in e)t.o(e,s)&&!t.o(a,s)&&Object.defineProperty(a,s,{enumerable:!0,get:e[s]})},o:(t,a)=>Object.prototype.hasOwnProperty.call(t,a)};(()=>{"use strict";const a=flarum.reg.get("core","common/extend"),e=flarum.reg.get("core","admin/app");var s=t.n(e);const n=flarum.reg.get("core","admin/components/BasicsPage");var l=t.n(n);const r=flarum.reg.get("core","admin/components/PermissionGrid");var i=t.n(r);const o=flarum.reg.get("core","admin/components/ExtensionPage");var d=t.n(o);const g=flarum.reg.get("core","admin/utils/saveSettings");var u=t.n(g);const c=flarum.reg.get("core","common/components/Alert");var h=t.n(c);const b=flarum.reg.get("core","common/components/Button");var _=t.n(b);const v=flarum.reg.get("core","common/components/FieldSet");var p=t.n(v);const f=flarum.reg.get("core","common/components/Switch");var y=t.n(f);const k=flarum.reg.get("core","common/components/UploadImageButton");var C=t.n(k);const z=flarum.reg.get("core","common/components/FormModal");var x=t.n(z);class w extends(x()){oninit(t){super.oninit(t),this.blogCategoriesOriginal=s().data.settings.blog_tags?s().data.settings.blog_tags.split("|"):[],this.blogCategories=s().data.settings.blog_tags?s().data.settings.blog_tags.split("|"):[],this.hasChanges=!1}title(){return"Select blog categories"}className(){return"Modal modal-dialog FlarumBlog-TagsModal"}content(){return m("div",null,m("div",{className:"Modal-body"},m("p",null,"Please select one or more tags that are considered blog tags."," ",m("a",{href:s().forum.attribute("baseUrl")+"/blog",target:"_blank"},"Visit your blog.")),m("table",{className:"FlarumBlog-TagsTable"},m("thead",null,m("tr",null,m("th",{width:"35"}),m("th",null,"Tag name"),m("th",{width:"50"}))),m("tbody",null,0===s().store.all("tags").length&&m("tr",null,m("td",{colSpan:"3"},"You currently have no tags.")),s().store.all("tags").map(t=>{if(t.parent())return;const a=()=>{const a=this.blogCategories.indexOf(t.id());this.hasChanges=!0,a>=0?this.blogCategories.splice(a,1):this.blogCategories.push(t.id())};return m("tr",null,m("td",null,m("i",{className:t.icon()})),m("td",{onclick:a},t.name()),m("td",null,m(y(),{state:this.blogCategories.indexOf(t.id())>=0,onchange:a})))})))),m("div",{style:"padding: 25px 30px; text-align: center;"},m(_(),{type:"submit",className:"Button Button--primary",loading:this.loading,disabled:this.loading},this.hasChanges?"Save changes":"Close")))}onsubmit(t){if(t.preventDefault(),!this.hasChanges)return void this.hide();this.loading=!0;let a=[];this.blogCategories.map(t=>{s().store.getById("tags",t)&&a.push(t)}),u()({blog_tags:a.join("|")}).then(()=>{s().alerts.show(h(),{type:"success"},s().translator.trans("core.admin.settings.saved_message")),this.hide()}).catch(()=>{s().alerts.show(h(),{type:"error"},s().translator.trans("core.lib.error.generic_message"))}).then(()=>{this.loaded()})}}flarum.reg.add("vadkuz-flarum2-blog","admin/components/Modals/SelectCategoriesModal",w);class N extends(d()){oninit(t){var a,e,n,l,r,i,o,d,g,m;super.oninit(t),this.hasChanges=!1,this.isSaving=!1,this.redirectsEnabled=null!=(a=s().data.settings.blog_redirects_enabled)?a:"both",this.hideTagsInList=null==(e=s().data.settings.blog_hide_tags)||e,this.allowComments=null==(n=s().data.settings.blog_allow_comments)||n,this.hideOnDiscussionList=null!=(l=s().data.settings.blog_filter_discussion_list)&&l,this.requiresReviewOnPost=null!=(r=s().data.settings.blog_requires_review)&&r,this.addCategoryHierarchy=null==(i=s().data.settings.blog_category_hierarchy)||i,this.addSidebarNav=null==(o=s().data.settings.blog_add_sidebar_nav)||o,this.featuredCount=null!=(d=s().data.settings.blog_featured_count)?d:3,this.blogAddHero=null==(g=s().data.settings.blog_add_hero)||g;const u=null!=(m=s().data.settings.blog_default_image_path)?m:null;s().forum.data.attributes.blog_default_imageUrl=u?"".concat(s().forum.attribute("baseUrl"),"/assets/").concat(u):null}content(){const t=s().data.settings.blog_tags?s().data.settings.blog_tags.split("|").length:0;return m("div",{className:"BasicsPage FlarumBlog"},m("div",{className:"container"},m("div",{className:"FlarumBlog-SelectCategories"},0===t?s().translator.trans("vadkuz-flarum2-blog.admin.settings.no_categories_selected"):s().translator.trans("vadkuz-flarum2-blog.admin.settings.selected_category_count",{count:t}),m(_(),{className:"Button",onclick:()=>s().modal.show(w)},s().translator.trans("vadkuz-flarum2-blog.admin.settings.select_categories_button"))),p().component({label:s().translator.trans("vadkuz-flarum2-blog.admin.settings.blog_heading")},[y().component({state:1==this.allowComments,onchange:t=>{this.allowComments=t,this.hasChanges=!0}},[m("b",null,s().translator.trans("vadkuz-flarum2-blog.admin.settings.allow_comments_label")),m("div",{className:"helpText"},s().translator.trans("vadkuz-flarum2-blog.admin.settings.allow_comments_text"))]),y().component({state:1==this.requiresReviewOnPost,onchange:t=>{this.requiresReviewOnPost=t,this.hasChanges=!0}},[m("b",null,s().translator.trans("vadkuz-flarum2-blog.admin.settings.require_review_label")),m("div",{className:"helpText"},s().translator.trans("vadkuz-flarum2-blog.admin.settings.require_review_text"))]),y().component({state:1==this.hideOnDiscussionList,onchange:t=>{this.hideOnDiscussionList=t,this.hasChanges=!0}},[m("b",null,s().translator.trans("vadkuz-flarum2-blog.admin.settings.hide_on_discussion_list_label")),m("div",{className:"helpText"},s().translator.trans("vadkuz-flarum2-blog.admin.settings.hide_on_discussion_list_text"))]),y().component({state:1==this.addSidebarNav,onchange:t=>{this.addSidebarNav=t,this.hasChanges=!0}},[m("b",null,s().translator.trans("vadkuz-flarum2-blog.admin.settings.add_sidebar_nav_label")),m("div",{className:"helpText"},s().translator.trans("vadkuz-flarum2-blog.admin.settings.add_sidebar_nav_text"))]),y().component({state:1==this.blogAddHero,onchange:t=>{this.blogAddHero=t,this.hasChanges=!0}},[m("b",null,s().translator.trans("vadkuz-flarum2-blog.admin.settings.add_hero_label")),m("div",{className:"helpText"},s().translator.trans("vadkuz-flarum2-blog.admin.settings.add_hero_text"))]),m("div",{className:"Form-group"},m("label",null,s().translator.trans("vadkuz-flarum2-blog.admin.settings.featured_count_label")),m("div",{className:"helpText"},s().translator.trans("vadkuz-flarum2-blog.admin.settings.featured_count_text")),m("input",{class:"FormControl",value:this.featuredCount,oninput:t=>{this.featuredCount=t.target.value,this.hasChanges=!0},placeholder:"3",type:"number"}))]),p().component({label:s().translator.trans("vadkuz-flarum2-blog.admin.settings.categories_heading")},[y().component({state:1==this.hideTagsInList,onchange:t=>{this.hideTagsInList=t,this.hasChanges=!0}},[m("b",null,s().translator.trans("vadkuz-flarum2-blog.admin.settings.hide_tags_in_taglist_label")),m("div",{className:"helpText"},s().translator.trans("vadkuz-flarum2-blog.admin.settings.hide_tags_in_taglist_text"))]),y().component({state:1==this.addCategoryHierarchy,onchange:t=>{this.addCategoryHierarchy=t,this.hasChanges=!0}},[m("b",null,s().translator.trans("vadkuz-flarum2-blog.admin.settings.show_tag_hierarchy_label")),m("div",{className:"helpText"},s().translator.trans("vadkuz-flarum2-blog.admin.settings.show_tag_hierarchy_text"))])]),p().component({label:s().translator.trans("vadkuz-flarum2-blog.admin.settings.redirects_heading")},[y().component({state:"both"===this.redirectsEnabled||"discussions_only"===this.redirectsEnabled,onchange:t=>{t?"tags_only"===this.redirectsEnabled?this.redirectsEnabled="both":"none"===this.redirectsEnabled&&(this.redirectsEnabled="discussions_only"):"discussions_only"===this.redirectsEnabled?this.redirectsEnabled="none":this.redirectsEnabled="tags_only",this.hasChanges=!0}},[m("b",null,s().translator.trans("vadkuz-flarum2-blog.admin.settings.redirect_articles_label")),m("div",{className:"helpText"},s().translator.trans("vadkuz-flarum2-blog.admin.settings.redirect_articles_text"))]),y().component({state:"both"===this.redirectsEnabled||"tags_only"===this.redirectsEnabled,onchange:t=>{t?"discussions_only"===this.redirectsEnabled?this.redirectsEnabled="both":"none"===this.redirectsEnabled&&(this.redirectsEnabled="tags_only"):"tags_only"===this.redirectsEnabled?this.redirectsEnabled="none":this.redirectsEnabled="discussions_only",this.hasChanges=!0}},[m("b",null,s().translator.trans("vadkuz-flarum2-blog.admin.settings.redirect_tags_label")),m("div",{className:"helpText"},s().translator.trans("vadkuz-flarum2-blog.admin.settings.redirect_tags_text"))])]),p().component({label:s().translator.trans("vadkuz-flarum2-blog.admin.settings.default_article_image_label")},[m("div",{className:"helpText"},s().translator.trans("vadkuz-flarum2-blog.admin.settings.default_article_image_text")),C().component({name:"blog_default_image",routePath:"blog_default_image",value:()=>{var t;return null!=(t=s().data.settings.blog_default_image_path)?t:null},url:()=>{var t;return null!=(t=s().forum.attribute("blog_default_imageUrl"))?t:null}})]),m(_(),{loading:this.isSaving,className:"Button Button--primary",onclick:()=>this.save(),disabled:!this.hasChanges},s().translator.trans("core.admin.settings.submit_button"))))}save(){this.isSaving=!0,u()({blog_add_sidebar_nav:this.addSidebarNav,blog_redirects_enabled:this.redirectsEnabled,blog_hide_tags:this.hideTagsInList,blog_requires_review:this.requiresReviewOnPost,blog_allow_comments:this.allowComments,blog_category_hierarchy:this.addCategoryHierarchy,blog_filter_discussion_list:this.hideOnDiscussionList,blog_featured_count:this.featuredCount,blog_add_hero:this.blogAddHero}).then(()=>{this.hasChanges=!1,s().alerts.show(h(),{type:"success"},s().translator.trans("core.admin.settings.saved_message"))}).catch(()=>{}).then(()=>{this.isSaving=!1,m.redraw()})}}flarum.reg.add("vadkuz-flarum2-blog","admin/pages/BlogSettings",N),s().initializers.add("vadkuz-flarum2-blog",()=>{s().registry.for("vadkuz-flarum2-blog").registerPage(N),s().registry.for("vadkuz-flarum2-blog").registerPermission({icon:"fas fa-pencil-alt",label:s().translator.trans("vadkuz-flarum2-blog.admin.permissions.write_articles"),permission:"blog.writeArticles"},"blog",90).registerPermission({icon:"far fa-star",label:s().translator.trans("vadkuz-flarum2-blog.admin.permissions.auto_approve_posts"),permission:"blog.autoApprovePosts"},"blog",90).registerPermission({icon:"far fa-thumbs-up",label:s().translator.trans("vadkuz-flarum2-blog.admin.permissions.approve_posts"),permission:"blog.canApprovePosts"},"blog",90),(0,a.extend)(i().prototype,"permissionItems",function(t){var a,e,n,l;const r=null==(a=this.attrs)?void 0:a.extensionId,i=r?null!=(e=null==(n=s().registry.getExtensionPermissions(r,"blog"))||null==(l=n.toArray)?void 0:l.call(n))?e:[]:s().registry.getAllPermissions("blog").toArray();t.add("blog",{label:s().translator.trans("vadkuz-flarum2-blog.admin.blog"),children:i},80)}),(0,a.extend)(l().prototype,"homePageItems",t=>{t.add("blog",{path:"/blog",label:s().translator.trans("vadkuz-flarum2-blog.admin.blog")})})})})(),module.exports={}})();
//# sourceMappingURL=admin.js.map