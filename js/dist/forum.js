(()=>{var t={n:e=>{var a=e&&e.__esModule?()=>e.default:()=>e;return t.d(a,{a}),a},d:(e,a)=>{for(var s in a)t.o(a,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:a[s]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};(()=>{"use strict";const e=flarum.reg.get("core","forum/app");var a=t.n(e);const s=flarum.reg.get("core","common/Model");var o=t.n(s);const l=flarum.reg.get("flarum-tags","common/models/Tag");var r=t.n(l);const i=flarum.reg.get("core","common/models/Discussion");var n=t.n(i);const u=flarum.reg.get("core","forum/components/IndexPage");var c=t.n(u);const d=flarum.reg.get("core","common/components/Page");var g=t.n(d);const h=flarum.reg.get("core","common/components/Button");var f=t.n(h);const p=flarum.reg.get("core","common/Component");var b=t.n(p);const v=flarum.reg.get("core","common/components/Link");var B=t.n(v);class y extends(b()){oninit(t){super.oninit(t),this.blogCategories=app.forum.attribute("blogTags")}view(){return m("div",{className:"BlogCategories BlogSideWidget"},m("h3",null,app.translator.trans("vadkuz-flarum2-blog.forum.categories")),this.blogCategories&&this.blogCategories.map(t=>{const e=app.store.getById("tags",t);if(!e)return null;const a=[];let s=1===this.blogCategories.length||e.slug()===m.route.param("slug");return app.store.all("tags").forEach(t=>{t.isChild()&&t.parent()===e&&(t.slug()===m.route.param("slug")&&(s=!0),a.push(this.categoryItem(t)))}),s?[this.categoryItem(e),...a]:this.categoryItem(e)}))}categoryItem(t){return m(B(),{href:app.route("blogCategory",{slug:t.slug()}),className:"BlogSideWidget-item BlogSideWidget-item-".concat(t.id()," ").concat(t.isChild()&&1==app.forum.attribute("blogCategoryHierarchy")?"BlogSideWidget-item-child":"")},m("span",{className:""===t.icon()?"BlogSideWidget-item-colored":"",style:{backgroundColor:""===t.icon()?t.color():null}},m("i",{className:t.icon()})),t.name())}}flarum.reg.add("vadkuz-flarum2-blog","forum/components/BlogCategories",y);const w=flarum.reg.get("core","forum/components/IndexSidebar");var N=t.n(w);const k=flarum.reg.get("core","common/components/SelectDropdown");var A=t.n(k);class I extends(b()){view(){return m("div",{className:"BlogForumNav BlogSideWidget"},m("h3",null,a().translator.trans("vadkuz-flarum2-blog.forum.forum_nav")),m("nav",{className:"IndexPage-nav sideNav"},m(A(),{buttonClassName:"Button",className:"App-titleControl"},this.navItems().toArray())))}navItems(){return N().prototype.navItems()}}flarum.reg.add("vadkuz-flarum2-blog","forum/components/ForumNav",I);const F=flarum.reg.get("core","common/components/Tooltip");var _=t.n(F);const z=flarum.reg.get("core","common/components/Icon");var C=t.n(z);const M=flarum.reg.get("core","common/helpers/humanTime");var S=t.n(M);const P=flarum.reg.get("core","common/utils/classList");var x=t.n(P);const L=flarum.reg.get("core","common/utils/ItemList");var D=t.n(L);class T extends(b()){titleItems(){var t,e,s,o;const{article:l}=this.attrs,r=new(D());return r.add("title",m("[",null,l.title()),100),(null!=(t=l.blogMeta())&&null!=(e=t.isPendingReview)&&e.call(t)||l.isHidden())&&r.add("hidden",m(C(),{name:"fas fa-eye-slash",className:"BlogList-item-hidden"}),80),null!=(s=l.blogMeta())&&null!=(o=s.isPendingReview)&&o.call(s)&&r.add("pendingReview",m(_(),{text:a().translator.trans("vadkuz-flarum2-blog.forum.review_article.pending_review")},m(C(),{name:"far fa-clock",className:"BlogList-item-pendingReview"})),40),r}dataItems(){var t,e;const{article:s}=this.attrs,o=new(D());return o.add("createdAt",m("span",{class:"BlogList-item-details-createdAt"},m(C(),{name:"far fa-clock"})," ",S()(s.createdAt())),100),o.add("author",m("span",{class:"BlogList-item-details-author"},m(C(),{name:"far fa-user"})," ",(null==(t=s.user())||null==(e=t.displayName)?void 0:e.call(t))||a().translator.trans("core.lib.username.deleted_text")),80),o.add("replies",m("span",{class:"BlogList-item-details-replies"},m(C(),{name:"far fa-comment"})," ",(s.commentCount()||1)-1),60),o}contentItems(){var t,e;const{article:a}=this.attrs,s=(null==(t=a.blogMeta())||null==(e=t.summary)?void 0:e.call(t))||"",o=new(D());return o.add("title",m("h4",null,this.titleItems().toArray()),100),s&&o.add("summary",m("p",null,s),80),o.add("data",m("div",{class:"data"},this.dataItems().toArray()),60),o}getImage(){var t,e;const{article:a,defaultImage:s}=this.attrs;return null!=(t=a.blogMeta())&&null!=(e=t.featuredImage)&&e.call(t)?"url(".concat(a.blogMeta().featuredImage(),")"):s}view(t){var e,s;const{article:o,defaultImage:l}=this.attrs,r=this.getImage(),i=null==(e=o.blogMeta())||null==(s=e.isSized)?void 0:s.call(e);return m(B(),{href:a().route("blogArticle",{id:"".concat(o.slug())}),className:x()("BlogList-item",{"BlogList-item-sized":i,"BlogList-item-default":!i},o.tags().map(t=>"BlogList-item-category-".concat(t.id())))},m("div",{class:x()("BlogList-item-photo",{"FlarumBlog-default-image":r===l}),style:{backgroundImage:r}}),m("div",{class:"BlogList-item-content"},this.contentItems().toArray()))}}flarum.reg.add("vadkuz-flarum2-blog","forum/components/BlogOverviewItem",T);class R extends(b()){topItems(){var t,e,s,o,l,r;const{article:i}=this.attrs,n=new(D());return n.add("tags",m("span",{class:"BlogFeatured-list-item-tags"},null==(t=i.tags())?void 0:t.map(t=>m("span",{class:"dataItem"},t.name()))),100),null!=(e=i.isSticky)&&e.call(i)&&n.add("sticky",m("span",{class:"BlogFeatured-list-item-isSticky dataItem"},m(C(),{name:"fas fa-thumbtack"})),80),(null!=(s=i.blogMeta())&&null!=(o=s.isPendingReview)&&o.call(s)||i.isHidden())&&n.add("hidden",m("span",{class:"BlogFeatured-list-item-isHidden dataItem"},m(C(),{name:"fas fa-eye-slash"})),60),null!=(l=i.blogMeta())&&null!=(r=l.isPendingReview)&&r.call(l)&&n.add("pendingReview",m(_(),{text:a().translator.trans("vadkuz-flarum2-blog.forum.review_article.pending_review"),position:"bottom"},m("span",{class:"BlogFeatured-list-item-pendingReview dataItem"},m(C(),{name:"far fa-clock"})," ",a().translator.trans("vadkuz-flarum2-blog.forum.review_article.pending_review_title"))),40),n}dataItems(){var t;const{article:e}=this.attrs,s=new(D());return s.add("createdAt",m("span",{class:"BlogFeatured-list-item-details-createdAt"},m(C(),{name:"far fa-clock"})," ",S()(e.createdAt())),100),s.add("author",m("span",{class:"BlogFeatured-list-item-details-author"},m(C(),{name:"far fa-user"})," ",(null==(t=e.user())?void 0:t.displayName())||a().translator.trans("core.lib.username.deleted_text")),80),s.add("replies",m("span",{class:"BlogFeatured-list-item-details-replies"},m(C(),{name:"far fa-comment"})," ",e.commentCount()-1),60),s}view(t){var e,s;const{article:o,defaultImage:l}=this.attrs,r=null!=(e=o.blogMeta())&&null!=(s=e.featuredImage)&&s.call(e)?"url(".concat(o.blogMeta().featuredImage(),")"):l;return m(B(),{href:a().route("blogArticle",{id:"".concat(o.slug())}),className:x()("BlogFeatured-list-item",o.tags().map(t=>"BlogFeatured-list-item-category-".concat(t.id())),"FlarumBlog-default-image"),style:{backgroundImage:r}},m("div",{class:"BlogFeatured-list-item-top"},this.topItems().toArray()),m("div",{className:"BlogFeatured-list-item-details"},m("h4",null,o.title()),m("div",{className:"data"},this.dataItems().toArray())))}}flarum.reg.add("vadkuz-flarum2-blog","forum/components/FeaturedBlogItem",R);class E extends(g()){oninit(t){super.oninit(t),a().setTitle(a().translator.trans("vadkuz-flarum2-blog.forum.blog")),this.bodyClass="BlogOverviewPage",this.isLoading=!0,this.featuredPosts=[],this.posts=[],this.hasMore=null,this.isLoadingMore=!1,this.languages=a().store.all("discussion-languages"),this.currentSelectedLanguage=m.route.param("lang")?m.route.param("lang"):a().translator.formatter.locale,a().history.push("blog"),this.loadBlogOverview(),this.featuredCount=parseInt(a().forum.attribute("blogFeaturedCount")),this.showCategories=!0,this.showForumNav=!0}loadBlogOverview(){const t=a().preloadedApiDocument();t?setTimeout(this.show.bind(this,t),0):this.reloadData(),m.redraw()}reloadData(){let t="is:blog".concat(m.route.param("slug")?" tag:".concat(m.route.param("slug")):"");null!==this.languages&&this.languages.length>=1&&(t+=" language:".concat(this.currentSelectedLanguage)),a().store.find("discussions",{filter:{q:t},sort:"-createdAt"}).then(this.show.bind(this)).catch(()=>{m.redraw()})}show(t){if(0===t.length)return this.isLoading=!1,void m.redraw();this.hasMore=t.payload.links&&t.payload.links.next?t.payload.links.next:null,this.featuredPosts=t.slice(0,this.featuredCount),this.posts=t.length>this.featuredCount?t.slice(this.featuredCount,t.length):[],this.isLoading=!1,m.redraw()}loadMore(){this.isLoadingMore=!0,a().store.find(this.hasMore.replace(a().forum.attribute("apiUrl"),"")).then(t=>{t.map(t=>this.posts.push(t)),this.hasMore=t.payload.links&&t.payload.links.next?t.payload.links.next:null}).catch(()=>{}).then(()=>{this.isLoadingMore=!1,m.redraw()})}title(){if(!m.route.param("slug"))return m("h2",null,a().translator.trans("vadkuz-flarum2-blog.forum.recent_posts"));const t=a().store.all("tags").filter(t=>t.slug()===m.route.param("slug"));return m("h2",null,t&&t[0]&&t[0].name(),m("small",null," ","- ",m(B(),{href:a().route("blog")},a().translator.trans("vadkuz-flarum2-blog.forum.return_to_overview"))))}view(){const t=a().forum.attribute("blogDefaultImage")?"url(".concat(a().forum.attribute("baseUrl")+"/assets/"+a().forum.attribute("blogDefaultImage"),")"):null;let e;const s=flarum.extensions["fof-discussion-language"];return s&&s.components&&s.components.LanguageDropdown&&(e=s.components.LanguageDropdown),[1==a().forum.attribute("blogAddHero")&&c().prototype.hero(),m("div",{className:"FlarumBlogOverview"},m("div",{className:"container"},m("div",{className:"BlogFeatured"},m("div",{className:"BlogOverviewButtons"},a().forum.attribute("canWriteBlogPosts")&&m(f(),{className:"Button",onclick:()=>this.newArticle(),icon:"fas fa-pencil-alt"},a().translator.trans("vadkuz-flarum2-blog.forum.compose.write_article")),null!==this.languages&&this.languages.length>=1&&m(e,{selected:this.currentSelectedLanguage,onclick:t=>{"string"==typeof t&&(this.currentSelectedLanguage=t,m.route.set(document.location.pathname,{lang:t}),this.reloadData())}})),this.title(),m("div",{style:{clear:"both"}}),m("div",{class:"BlogFeatured-list"},this.isLoading&&[...new Array(this.featuredCount).fill(void 0)].map(()=>m("div",{class:"BlogFeatured-list-item BlogFeatured-list-item-ghost"},m("div",{class:"BlogFeatured-list-item-details"},m("h4",null," "),m("div",{class:"data"},m("span",null,m("i",{class:"far fa-wave"})))))),!this.isLoading&&this.featuredPosts.length>=0&&this.featuredPosts.map(e=>m(R,{article:e,defaultImage:t})))),m("div",{className:"BlogScrubber"},m("div",{className:"BlogList"},this.isLoading&&[!1,!1,!0,!1].map(t=>m("div",{className:"BlogList-item BlogList-item-".concat(!0===t?"sized":"default"," BlogList-item-ghost")},m("div",{className:"BlogList-item-photo FlarumBlog-default-image"}),m("div",{className:"BlogList-item-content"},m("h4",null," "),m("p",null," "),m("div",{className:"data"},m("span",null,m("i",{className:"far fa-wave"})))))),!this.isLoading&&this.posts.length>=1&&this.posts.map(e=>m(T,{article:e,defaultImage:t})),!this.isLoading&&this.featuredPosts.length>0&&null===this.hasMore&&m("p",{className:"FlarumBlog-reached-end"},a().translator.trans("vadkuz-flarum2-blog.forum.no_more_posts")),!this.isLoading&&0===this.featuredPosts.length&&0===this.posts.length&&m("p",{className:"FlarumBlog-reached-end"},a().translator.trans("vadkuz-flarum2-blog.forum.category_empty")),!this.isLoading&&null!==this.hasMore&&m("div",{className:"FlarumBlog-reached-load-more"},m(f(),{className:"Button",onclick:()=>this.loadMore(),icon:"fas fa-chevron-down",loading:this.isLoadingMore},a().translator.trans("core.forum.discussion_list.load_more_button")))),m("div",{className:"Sidebar"},this.showCategories&&m(y,null),this.showForumNav&&m(I,null)))))]}newArticle(){let t=[];const e=a().store.getBy("tags","slug",m.route.param("slug"));e&&t.push(e),m.route.set(a().route("blogComposer",{tags:t.map(t=>t.id()).join(),lang:this.languages.length>0?this.currentSelectedLanguage:void 0}))}}flarum.reg.add("vadkuz-flarum2-blog","forum/pages/BlogOverview",E);const O=flarum.reg.get("core","forum/components/DiscussionPage");var G=t.n(O);const H=flarum.reg.get("core","common/extend"),W=flarum.reg.get("core","common/utils/mixin");var U=t.n(W);class j extends(U()(o(),{discussion:o().hasOne("discussion"),featuredImage:o().attribute("featuredImage"),summary:o().attribute("summary"),isFeatured:o().attribute("isFeatured"),isSized:o().attribute("isSized"),isPendingReview:o().attribute("isPendingReview")})){}flarum.reg.add("vadkuz-flarum2-blog","common/Models/BlogMeta",j);const q=flarum.reg.get("flarum-tags","forum/components/TagsPage");var V=t.n(q);function J(){(0,H.extend)(V().prototype,"view",function(t){if(this.loading)return t;if(0==app.forum.attribute("blogHideTags"))return t;const e=app.forum.attribute("blogTags")||[],a=K(t,"TagsPage-content",!0),s=null==a?void 0:a.children[0];return a&&s?(s.children=s.children.map((t,a)=>e.indexOf(this.tags[a].id())>=0?null:t),t):t}),(0,H.extend)(c().prototype,"navItems",function(t){return 0==app.forum.attribute("blogHideTags")||(app.forum.attribute("blogTags")||[]).forEach(e=>{t.remove("tag".concat(e))}),t})}function K(t,e,a,s,o){void 0===a&&(a=!1),void 0===s&&(s=50),void 0===o&&(o=0);const l=function(t){if(Array.isArray(t))return t;const e=(null==t?void 0:t.children)||[];return Array.isArray(e)?e:[]}(t);let r=null;for(let t=0;t<l.length;t++){var i;if(((null==(i=l[t])||null==(i=i.attrs)?void 0:i.className)||"").includes(e)){r=l[t];break}}if(a&&!r&&o<s)for(let t of l){const a=K(t,e,!0,s,o+1);if(a)return a}return r}function Q(){const t=app.route.discussion;app.route.discussion=(e,a)=>{let s=!1;if(("both"===app.forum.attribute("blogRedirectsEnabled")||"discussions_only"===app.forum.attribute("blogRedirectsEnabled"))&&e.tags().length>0){const t=(app.forum.attribute("blogTags")||[]).map(t=>parseInt(t,10)).filter(t=>Number.isInteger(t)),a=e.tags().filter(e=>((t,e)=>{var a,s,o,l;const r=parseInt(null==(a=t.id)?void 0:a.call(t),10),i=null!=(s=t.parent)&&s.call(t)?parseInt(null==(o=(l=t.parent()).id)?void 0:o.call(l),10):null;return e.includes(r)||null!==i&&e.includes(i)})(e,t));a.length>0&&(s=!0)}return s?e.lastReadPostNumber()>1?app.route("blogArticle.near",{id:e.slug(),near:e.lastReadPostNumber()}):app.route("blogArticle",{id:e.slug()}):t(e,a)}}flarum.reg.add("vadkuz-flarum2-blog","forum/utils/extendTagOverview",J);const X=flarum.reg.get("core","common/helpers/listItems");var Y=t.n(X);const Z=flarum.reg.get("core","common/components/Avatar");var $=t.n(Z);class tt extends(b()){view(){const t=this.attrs.loading?null:this.attrs.article?this.attrs.article.user():this.attrs.user;return m("div",{className:"FlarumBlog-Article-Author"},m("div",{className:"FlarumBlog-Article-Author-background ".concat(this.attrs.loading?"FlarumBlog-Author-Ghost":""),style:{backgroundColor:t&&t.color()?t.color():null}}),m("div",{className:"FlarumBlog-Article-Author-Avatar"},t?m(B(),{href:app.route("user",{username:t.username()})},m($(),{user:t})):m("span",{className:"Avatar FlarumBlog-Author-Ghost"})),t&&m("div",{className:"FlarumBlog-Article-Author-Info"},m(B(),{href:app.route("user",{username:t.username()}),className:"FlarumBlog-Article-Author-Name"},t.displayName()),m("p",{className:"FlarumBlog-Article-Author-Bio"},t.bio&&t.bio()),m("ul",{className:"FlarumBlog-Article-Author-Extended"},Y()(this.items().toArray()))),this.attrs.loading&&m("div",null,m("span",{className:"FlarumBlog-Article-Author-Name FlarumBlog-Author-Ghost"}," "),m("p",{className:"FlarumBlog-Article-Author-Bio FlarumBlog-Author-Ghost"}," "),m("p",{className:"FlarumBlog-Article-Author-Bio FlarumBlog-Author-Ghost"}," "),m("p",{className:"FlarumBlog-Article-Author-Bio FlarumBlog-Author-Ghost"}," ")))}items(){return new(D())}}flarum.reg.add("vadkuz-flarum2-blog","forum/components/BlogItemSidebar/BlogAuthor",tt);const et=flarum.reg.get("core","common/components/Modal");var at=t.n(et);const st=flarum.reg.get("core","common/utils/Stream");var ot=t.n(st);class lt extends(at()){oninit(t){super.oninit(t),this.article=this.attrs.article,this.name=ot()(this.article.title()||""),this.redirect=this.attrs.redirect}className(){return"Modal--small Support-Modal"}title(){return app.translator.trans("vadkuz-flarum2-blog.forum.tools.rename_article")}content(){return m("div",{className:"Modal-body"},m("form",{className:"Form",onsubmit:this.onsubmit.bind(this)},this.fields().toArray()))}fields(){const t=new(D());return t.add("name",m("div",{className:"Form-group"},m("label",null,app.translator.trans("vadkuz-flarum2-blog.forum.article.title"),":"),m("input",{className:"FormControl",placeholder:app.translator.trans("vadkuz-flarum2-blog.forum.article.title"),bidi:this.name})),50),t.add("submit",m("div",{className:"Form-group"},f().component({type:"submit",className:"Button Button--primary SupportModal-save",loading:this.loading},app.translator.trans("core.forum.composer_edit.submit_button"))),-10),t}submitData(){return{title:this.name()}}onsubmit(t){if(t.preventDefault(),this.loading=!0,this.attrs.onChange)return this.attrs.onChange(this.name()),void this.hide();this.article.save({title:this.name()}).then(()=>{if(this.hide(),this.redirect){const t="/blog/".concat(this.article.slug());m.route.set(t,!0),window.history.replaceState(null,document.title,t)}},t=>{this.loading=!1,this.handleErrors(t)})}}flarum.reg.add("vadkuz-flarum2-blog","forum/components/Modals/RenameArticleModal",lt);const rt=flarum.reg.get("core","common/components/Switch");var it=t.n(rt);flarum.reg.add("vadkuz-flarum2-blog","forum/utils/selectFiles",function(t,e){return new Promise(a=>{let s=document.createElement("input");s.type="file",s.multiple=e,s.accept=t,s.onchange=t=>{let o=Array.from(s.files||[]);a(e?o:o[0])},s.click()})});class nt extends(at()){oninit(t){super.oninit(t),this.attrs.article?this.meta=this.attrs.article&&this.attrs.article.blogMeta()?this.attrs.article.blogMeta():a().store.createRecord("blogMeta"):this.meta=this.attrs.meta?this.attrs.meta:a().store.createRecord("blogMeta"),this.isNew=!this.meta.exists,this.summary=ot()(this.meta.summary()||""),this.featuredImage=ot()(this.meta.featuredImage()||""),this.isFeatured=ot()(this.meta.isFeatured()||!1),this.isSized=ot()(this.meta.isSized()||!1),this.isPendingReview=ot()(this.meta.isPendingReview()||!1)}className(){return"Modal--small Support-Modal"}title(){return a().translator.trans("vadkuz-flarum2-blog.forum.article_settings.title")}content(){return m("div",{className:"Modal-body"},m("form",{className:"Form",onsubmit:this.onsubmit.bind(this)},this.fields().toArray()))}fields(){const t=new(D());t.add("summary",m("div",{className:"Form-group"},m("label",null,a().translator.trans("vadkuz-flarum2-blog.forum.article_settings.fields.summary.title"),":"),m("textarea",{className:"FormControl",style:{maxWidth:"100%",minWidth:"100%",width:"100%",minHeight:"120px"},bidi:this.summary,placeholder:a().translator.trans("vadkuz-flarum2-blog.forum.article_settings.fields.summary.placeholder")}),m("small",null,a().translator.trans("vadkuz-flarum2-blog.forum.article_settings.fields.summary.helper_text"))),30);let e=null;if("fof-upload"in flarum.extensions&&a().forum.attribute("fof-upload.canUpload")){const t=flarum.extensions["fof-upload"],s=t&&t.components?t.components.Uploader:null,o=t&&t.components?t.components.FileManagerModal:null;if(s&&o){const t=new s;e=m(f(),{class:"Button Button--icon",onclick:async()=>{a().modal.show(o,{uploader:t,onSelect:t=>{const e=a().store.getById("files",t[0]);this.featuredImage(e.url())}},!0)},icon:"fas fa-cloud-upload-alt"})}}return t.add("image",m("div",{className:"Form-group VadkuzBlog-ArticleImage"},m("label",null,a().translator.trans("vadkuz-flarum2-blog.forum.article_settings.fields.image.title"),":"),m("div",{"data-upload-enabled":!!e},m("input",{type:"text",className:"FormControl",bidi:this.featuredImage,placeholder:"https://"}),e),m("small",null,a().translator.trans("vadkuz-flarum2-blog.forum.article_settings.fields.image.helper_text")),""!==this.featuredImage()&&m("img",{src:this.featuredImage(),alt:"Article image",title:a().translator.trans("vadkuz-flarum2-blog.forum.article_settings.fields.image.title"),style:{width:"100%",marginTop:"15px"}})),30),t.add("sized",m("div",{className:"Form-group"},it().component({state:1==this.isSized(),onchange:t=>{this.isSized(t)}},[m("b",null,a().translator.trans("vadkuz-flarum2-blog.forum.article_settings.fields.highlight.title")),m("div",{className:"helpText",style:{fontWeight:500}},a().translator.trans("vadkuz-flarum2-blog.forum.article_settings.fields.highlight.helper_text"))])),-10),t.add("submit",m("div",{className:"Form-group"},f().component({type:"submit",className:"Button Button--primary SupportModal-save",loading:this.loading},a().translator.trans("core.forum.composer_edit.submit_button"))),-10),t}submitData(){return{summary:this.summary(),featuredImage:this.featuredImage(),isFeatured:this.isFeatured(),isSized:this.isSized(),isPendingReview:this.isPendingReview(),relationships:this.isNew&&!this.attrs.isComposer?{discussion:this.attrs.article}:null}}onsubmit(t){if(t.preventDefault(),this.attrs.onsubmit)return this.meta.pushData({attributes:this.submitData()}),this.attrs.onsubmit(this.meta),void this.hide();this.loading=!0,this.meta.save(this.submitData()).then(()=>{this.attrs.article&&this.attrs.article.pushData({relationships:{blogMeta:this.meta}}),this.hide(),m.redraw()},t=>{this.loading=!1,this.handleErrors(t)})}}flarum.reg.add("vadkuz-flarum2-blog","forum/components/Modals/BlogPostSettingsModal",nt);const mt=flarum.reg.get("core","common/components/TextEditor");var ut=t.n(mt);class ct extends(b()){view(){return m("div",null)}oncreate(t){super.oncreate(t),s9e.TextFormatter.preview(t.attrs.content||"",t.dom)}}flarum.reg.add("vadkuz-flarum2-blog","forum/components/Composer/ComposerPreview",ct);class dt extends(b()){oninit(t){super.oninit(t),this.composer=this.attrs.composer,this.previewContent=!1}view(){var t,e;this.composer=this.attrs.composer;const s=null!=(t=this.composer)&&null!=(t=t.fields)&&t.content?this.composer.fields.content():"",o=""!==s,l=!!this.attrs.disabled;return m("div",{className:"Flarum-Blog-Composer ".concat(l?"Flarum-Blog-Composer-Loading":"")},m("div",{className:"Flarum-Blog-Composer-tabs"},m(f(),{className:!this.previewContent&&"AricleComposerButtonSelected",onclick:()=>this.previewContent=!1},a().translator.trans("vadkuz-flarum2-blog.forum.composer.write")),m(f(),{className:this.previewContent&&"AricleComposerButtonSelected",onclick:()=>this.previewContent=!0},a().translator.trans("vadkuz-flarum2-blog.forum.composer.view"))),m("div",{className:"Composer Flarum-Blog-Composer-body ".concat(this.previewContent?"Flarum-Blog-Composer-HideEditor":"")},this.previewContent&&m("div",{className:"Flarum-Blog-Composer-preview"},!o&&a().translator.trans("vadkuz-flarum2-blog.forum.composer.nothing_to_preview"),m(ct,{content:this.composer.fields.content()})),ut().component({submitLabel:this.attrs.submitLabel||a().translator.trans("core.forum.composer_edit.submit_button"),placeholder:this.attrs.placeholder,disabled:l,composer:this.composer,onchange:null==(e=this.composer)||null==(e=e.fields)?void 0:e.content,onsubmit:this.onsubmit.bind(this),value:s})))}onsubmit(){this.attrs.onsubmit&&this.attrs.onsubmit()}}flarum.reg.add("vadkuz-flarum2-blog","forum/components/Composer/Composer",dt);class gt extends(g()){oninit(t){if(super.oninit(t),a().setTitle(a().translator.trans("vadkuz-flarum2-blog.forum.blog")),a().forum.attribute("canWriteBlogPosts")){if(a().history.push("blogComposer"),this.languages=a().store.all("discussion-languages")||[],this.bodyClass="BlogItemPage BlogItemPage--composer",this.articleLanguage=ot()(m.route.param("lang")?m.route.param("lang"):a().translator.locale),this.article=a().store.createRecord("discussions"),this.blogMeta=null,this.tags=[],m.route.param().tags){const t=Array.isArray(m.route.param().tags)?m.route.param().tags:m.route.param().tags.split(",");m.route.param().tags.length>0&&t.forEach(t=>{const e=a().store.getById("tags",t);e&&this.tags.push(e)})}this.isSaving=!1}else m.route.set(a().route("blog"))}openTagsModal(t){void 0===t&&(t=null),t&&t.preventDefault(),this.isSaving||a().modal.show(()=>flarum.reg.asyncModuleImport("ext:flarum/tags/forum/components/TagDiscussionModal"),{selectedTags:this.tags,onsubmit:t=>{this.tags=t}})}openNameArticleModal(t){void 0===t&&(t=null),t&&t.preventDefault(),this.isSaving||a().modal.show(lt,{article:this.article,onChange:t=>{this.article.pushData({attributes:{title:t}})}})}openBlogSettings(t){t.preventDefault(),this.isSaving||a().modal.show(nt,{meta:this.blogMeta,onsubmit:t=>this.blogMeta=t})}view(){return m("div",{className:"FlarumBlogItem"},m("div",{className:"container"},this.pageItems().toArray()))}pageItems(){const t=new(D());return t.add("toolButtons",m("div",{className:"FlarumBlog-ToolButtons"},m(B(),{href:a().route("blog"),className:"Button",loading:this.isSaving,icon:"fas fa-angle-left"},m("i",{class:"icon fas fa-angle-left Button-icon"}),m("span",{class:"Button-label"},a().translator.trans("vadkuz-flarum2-blog.forum.return_to_overview")))),100),t.add("article",m("div",{className:"FlarumBlog-Article"},this.articleWrapperItems().toArray()),90),t}articleWrapperItems(){const t=new(D());return t.add("container",m("div",{className:"FlarumBlog-Article-Container"},this.articleItems().toArray()),100),t.add("sidebar",m("div",{className:"FlarumBlog-Article-Sidebar"},m(tt,{user:a().session.user})),90),t}articleItems(){const t=new(D()),e=a().forum.attribute("blogDefaultImage")?"url(".concat(a().forum.attribute("baseUrl")+"/assets/"+a().forum.attribute("blogDefaultImage"),")"):null,s=this.blogMeta&&this.blogMeta.featuredImage()?"url(".concat(this.blogMeta.featuredImage(),")"):e;let o;const l=flarum.extensions["fof-discussion-language"];return l&&l.components&&l.components.LanguageDropdown&&(o=l.components.LanguageDropdown),t.add("content",m("div",{className:"FlarumBlog-Article-Content"},m("div",{className:"FlarumBlog-Article-Image FlarumBlog-default-image",style:{backgroundImage:s,cursor:"pointer"},onclick:t=>this.openBlogSettings(t)}),m("div",{className:"FlarumBlog-Article-Content-Edit-Button"},m("div",{className:0===this.languages.length?"FlarumBlog-Article-Content-Edit-Dropdown":"FlarumBlog-Article-Content-EditButtons"},null!==this.languages&&this.languages.length>=1&&m(o,{selected:this.articleLanguage(),onclick:t=>{"string"==typeof t&&this.articleLanguage(t)}}),m(f(),{className:"Button",onclick:t=>this.openBlogSettings(t),icon:"fas fa-pencil-alt",loading:this.isSaving},a().translator.trans("vadkuz-flarum2-blog.forum.composer.update_settings")))),m("div",{className:"FlarumBlog-Article-Categories"},this.tags.map(t=>m("button",{class:"Button Button--text",onclick:t=>this.openTagsModal(t)},t.name())),m("button",{class:"Button Button--text",onclick:t=>this.openTagsModal(t)},0===this.tags.length?a().translator.trans("vadkuz-flarum2-blog.forum.composer.select_category"):a().translator.trans("vadkuz-flarum2-blog.forum.composer.edit_categories")," ",m("i",{className:"fas fa-edit"}))),m("div",{className:"FlarumBlog-Article-Post"},m("h1",{onclick:()=>this.openNameArticleModal(),className:"FlarumBlog-Article-Title",style:{cursor:"pointer"}},this.article&&this.article.title()&&""!==this.article.title()?this.article.title():a().translator.trans("vadkuz-flarum2-blog.forum.composer.no_title"),m("button",{class:"Button Button--text",onclick:t=>t.preventDefault()},m("i",{className:"fas fa-edit"}))),m("div",{className:"Post-body"},m(dt,{composer:a().composer,originalContent:"",submitLabel:a().translator.trans("vadkuz-flarum2-blog.forum.composer.post_article"),placeholder:a().translator.trans("vadkuz-flarum2-blog.forum.composer.enter_message_here"),onsubmit:()=>this.create(),disabled:this.isSaving})))),100),t.add("commentsPlaceholder",m("div",{className:"FlarumBlog-Article-Comments"},m("h4",null,a().translator.trans("vadkuz-flarum2-blog.forum.comment_section.comments")," (0)"),m("div",{className:"Post-body"},m("blockquote",{class:"uncited"},m("div",null,m("span",{className:"fas fa-ban",style:{marginRight:"5px"}})," ",a().translator.trans("vadkuz-flarum2-blog.forum.composer.comment_section"))))),90),t}create(){const t=(a().forum.attribute("blogTags")||[]).map(t=>parseInt(t,10)).filter(t=>Number.isInteger(t));if(0===this.tags.length)return void this.openTagsModal();if(!this.article.title()||""===this.article.title())return void this.openNameArticleModal();if(0===this.tags.filter(e=>{var a,s,o,l;const r=parseInt(null==(a=e.id)?void 0:a.call(e),10),i=null!=(s=e.parent)&&s.call(e)?parseInt(null==(o=(l=e.parent()).id)?void 0:o.call(l),10):null;return t.includes(r)||null!==i&&t.includes(i)}).length)return void alert(a().translator.trans("vadkuz-flarum2-blog.forum.composer.no_blog_tags_selected"));if(!(null!==this.blogMeta&&(this.blogMeta.featuredImage()||a().forum.attribute("blogDefaultImage"))&&this.blogMeta.summary()||confirm(a().translator.trans("vadkuz-flarum2-blog.forum.composer.post_without_blog_info"))))return;let e={tags:this.tags};this.languages.length>0&&(e.language=a().store.getBy("discussion-languages","code",this.articleLanguage()));const s={title:this.article.title(),content:a().composer.fields.content(),relationships:e};this.isSaving=!0;const o=null!==this.blogMeta&&(Boolean(this.blogMeta.featuredImage())||Boolean(this.blogMeta.summary())||Boolean(this.blogMeta.isSized()));this.article.save(s).then(t=>(o?a().request({method:"POST",url:"".concat(a().forum.attribute("apiUrl"),"/blogMeta"),body:{data:{type:"blogMeta",attributes:{featuredImage:this.blogMeta.featuredImage(),summary:this.blogMeta.summary(),isSized:this.blogMeta.isSized()},relationships:{discussion:{data:{type:"discussions",id:t.id()}}}}}}).catch(()=>null):Promise.resolve(null)).then(()=>t)).then(t=>{setTimeout(()=>{m.route.set(a().route("blogArticle",{id:"".concat(t.slug())}))},500)}).catch(()=>{this.isSaving=!1,m.redraw()})}}flarum.reg.add("vadkuz-flarum2-blog","forum/pages/BlogComposer",gt);const ht=flarum.reg.get("core","common/components/LinkButton");var ft=t.n(ht);function pt(){(0,H.extend)(N().prototype,"navItems",function(t){return a().forum.attribute("blogAddSidebarNav")&&"0"!==a().forum.attribute("blogAddSidebarNav")&&t.add("blog",m(ft(),{icon:"fas fa-comment",href:a().route("blog")},a().translator.trans("vadkuz-flarum2-blog.forum.blog")),15),t})}flarum.reg.add("vadkuz-flarum2-blog","forum/utils/addSidebarNav",pt);const bt=flarum.reg.get("core","forum/components/CommentPost");var vt=t.n(bt);const Bt=flarum.reg.get("core","forum/states/PostStreamState");var yt=t.n(Bt);const wt=flarum.reg.get("core","forum/utils/DiscussionControls");var Nt=t.n(wt);const kt=flarum.reg.get("core","common/components/Alert");var At=t.n(kt);const It=flarum.reg.get("core","common/components/Dropdown");var Ft=t.n(It);const _t=flarum.reg.get("core","forum/components/EditPostComposer");var zt=t.n(_t);const Ct=flarum.reg.get("core","common/utils/extractText");var Mt=t.n(Ct);class St extends(b()){init(){this.loadedPost=!1}manageArticleButtons(){const t=this.attrs.article,e=new(D()),s=flarum.extensions["fof-discussion-language"]&&void 0!==flarum.extensions["fof-discussion-language"].components?flarum.extensions["fof-discussion-language"].components.LanguageDiscussionModal:null;t.canRename()&&e.add("rename",f().component({className:"Button",onclick:()=>a().modal.show(lt,{article:t}),icon:"fas fa-pencil-alt"},a().translator.trans("vadkuz-flarum2-blog.forum.tools.rename_article")),100);const o=t.firstPost();e.add("edit",f().component({className:"Button",disabled:!o||!o.canEdit(),onclick:()=>{a().composer.load(zt(),{post:o}),a().composer.show()},icon:"fas fa-edit"},a().translator.trans("vadkuz-flarum2-blog.forum.tools.edit_article")),90),e.add("articleSettings",f().component({className:"Button",onclick:()=>a().modal.show(nt,{article:t}),icon:"fas fa-cogs"},a().translator.trans("vadkuz-flarum2-blog.forum.tools.article_settings")),80),t.canTag()&&e.add("tag",f().component({className:"Button",onclick:()=>a().modal.show(()=>flarum.reg.asyncModuleImport("ext:flarum/tags/forum/components/TagDiscussionModal"),{discussion:t}),icon:"fas fa-tag"},a().translator.trans("vadkuz-flarum2-blog.forum.tools.update_category")),70);const l=flarum.extensions["v17development-seo"],r=l&&l.components?l.components.MetaSeoModal:null;return t.blogMeta()&&r&&a().forum.attribute("canConfigureSeo")&&e.add("seo",f().component({className:"Button",onclick:()=>a().modal.show(r,{objectType:"blogs",objectId:t.blogMeta().id()}),icon:"fas fa-search"},a().translator.trans("v17development-flarum-seo.forum.controls.configure_seo")),70),t.blogMeta()&&t.blogMeta().isPendingReview()&&(e.add("separator1",m("li",{className:"Dropdown-separator"}),65),e.add("approve",f().component({className:"Button",disabled:!a().forum.attribute("canApproveBlogPosts"),onclick:()=>{t.blogMeta().save({isPendingReview:!1}).then(()=>{a().alerts.show(At(),{type:"success"},a().translator.trans("vadkuz-flarum2-blog.forum.review_article.approve_article_approved"))},t=>{this.loading=!1,this.handleErrors(t)})},icon:"fas fa-thumbs-up"},a().translator.trans("vadkuz-flarum2-blog.forum.review_article.approve_article")),60)),t.canChangeLanguage&&t.canChangeLanguage()&&s&&e.add("lang",f().component({icon:"fas fa-globe",onclick:()=>a().modal.show(s,{discussion:t})},a().translator.trans("fof-discussion-language.forum.discussion_controls.change_language_button")),50),e.add("separator2",m("li",{className:"Dropdown-separator"}),40),t.canLock()&&e.add("lock",f().component({className:"Button",onclick:Nt().lockAction.bind(t),icon:"fas ".concat(t.isLocked()?"fa-comments":"fa-comment-slash")},t.isLocked()?a().translator.trans("vadkuz-flarum2-blog.forum.tools.enable_comments"):a().translator.trans("vadkuz-flarum2-blog.forum.tools.disable_comments")),30),t.canHide()&&(t.isHidden()?(e.add("recover",f().component({className:"Button",onclick:Nt().restoreAction.bind(t),icon:"fas fa-eye"},a().translator.trans("vadkuz-flarum2-blog.forum.tools.recover_article")),20),t.canDelete()&&e.add("delete",f().component({className:"Button",onclick:()=>{if(confirm(Mt()(a().translator.trans("core.forum.discussion_controls.delete_confirmation"))))return"blogArticle"===a().history.getCurrent().name&&(a().previous?a().history.back():m.route.set(a().route("blog"))),t.delete().then(()=>{m.redraw()})},icon:"far fa-trash-alt"},a().translator.trans("vadkuz-flarum2-blog.forum.tools.delete_forever")),10)):e.add("hide",f().component({className:"Button",onclick:Nt().hideAction.bind(t),icon:"fas fa-eye-slash"},a().translator.trans("vadkuz-flarum2-blog.forum.tools.hide_article")),0)),e}view(){const t=this.attrs.article.firstPost();return m("div",{className:"FlarumBlog-Article-Content-Edit-Button"},m("div",{className:"FlarumBlog-Article-Content-Edit-Dropdown"},Ft().component({icon:"fas fa-cog",label:"Manage",buttonClassName:"Button",menuClassName:"Dropdown-menu--right",onshow:()=>{!t||t.canEdit()||this.loadedPost||(this.loadedPost=!0,m.redraw())}},this.manageArticleButtons().toArray())))}}flarum.reg.add("vadkuz-flarum2-blog","forum/components/BlogPostController",St);class Pt extends(b()){view(){return m("div",{className:"FlarumBlog-Article-Sidebar"},m("ul",null,Y()(this.items().toArray())))}items(){const t=new(D());return t.add("author",tt.component(this.attrs),0),t.add("categories",y.component(this.attrs),0),t.add("nav",I.component(this.attrs),0),t}}flarum.reg.add("vadkuz-flarum2-blog","forum/components/BlogItemSidebar/BlogItemSidebar",Pt);const xt=flarum.reg.get("core","common/helpers/fullTime");var Lt=t.n(xt);class Dt extends(b()){view(){const t=this.attrs.discussion.subscription(),e=app.session.user.preferences().notify_newPost_email,a=Mt()(app.translator.trans(e?"flarum-subscriptions.forum.sub_controls.notify_email_tooltip":"flarum-subscriptions.forum.sub_controls.notify_alert_tooltip"));let s=app.translator.trans("flarum-subscriptions.forum.sub_controls.not_following_button"),o="far fa-star";return"follow"===t&&(s=app.translator.trans("flarum-subscriptions.forum.sub_controls.following_button"),o="fas fa-star"),m(_(),{text:a,position:"bottom"},m(f(),{className:"Button BlogArticleSubscription SubscriptionMenu-button--".concat(t),icon:o,onclick:this.saveSubscription.bind(this,this.attrs.discussion,-1!==["follow","ignore"].indexOf(t)?null:"follow")},s))}saveSubscription(t,e){t.save({subscription:e})}}flarum.reg.add("vadkuz-flarum2-blog","forum/components/ArticleSubscription",Dt);class Tt extends(g()){oninit(t){super.oninit(t),a().setTitle(a().translator.trans("vadkuz-flarum2-blog.forum.blog")),a().history.push("blogArticle"),this.bodyClass="BlogItemPage",this.near=m.route.param("near")||0,this.loading=!0,this.found=!1,this.article=null,this.PostStream=null,this.loadPostStreamComponent(),this.loadBlogItem()}loadPostStreamComponent(){flarum.reg.asyncModuleImport("flarum/forum/components/PostStream").then(t=>{this.PostStream=t.default,m.redraw()})}loadBlogItem(){const t=a().preloadedApiDocument();t?setTimeout(this.show.bind(this,t),0):a().store.find("discussions",m.route.param("id").split("-")[0]).then(this.show.bind(this)).catch(()=>{m.redraw()}),m.redraw()}show(t){this.article=t,a().setTitle("".concat(t.title()," - ").concat(a().translator.trans("vadkuz-flarum2-blog.forum.blog"))),this.loading=!1;let e=[];if(t.payload&&t.payload.included){const s=t.id();e=t.payload.included.filter(t=>"posts"===t.type&&t.relationships&&t.relationships.discussion&&t.relationships.discussion.data.id===s).map(t=>a().store.getById("posts",t.id)).sort((t,e)=>t.id()-e.id()).slice(0,20)}this.stream=new(yt())(t,e),this.near&&this.stream.goToNumber(this.near||0,!0).then(()=>{a().current.set("discussion",t),a().current.set("stream",this.stream)}),a().session.user&&!t.lastReadPostNumber()&&t.save({lastReadPostNumber:1}),m.redraw()}postItems(){var t,e,s,o;let l=null;var r,i;!this.loading&&this.article&&(l=null==(r=this.article)||null==(i=r.firstPost)?void 0:i.call(r));const n=new(D());var u,c,d;return n.add("title",m("h1",{className:x()("FlarumBlog-Article-Title",{"FlarumBlog-Article-GhostTitle":this.loading})},(null==this||null==(t=this.article)||null==(e=t.title)?void 0:e.call(t))||"Ghost title",(null==(s=this.article)||null==(o=s.isHidden)?void 0:o.call(s))&&"(".concat(a().translator.trans("vadkuz-flarum2-blog.forum.hidden"),")")),100),n.add("publishDate",m("div",{className:x()("FlarumBlog-Article-PublishDate",{"FlarumBlog-Article-GhostPublishDate":this.loading})},this.article?Lt()(this.article.createdAt()):m("span",null," ")),80),this.loading&&n.add("skeleton",[0,1,2].map(()=>m("div",null,m("p",{className:"FlarumBlog-Article-GhostParagraph"}," "),m("p",{className:"FlarumBlog-Article-GhostParagraph"}," "),m("p",{className:"FlarumBlog-Article-GhostParagraph"}," "),m("p",null," "))),60),this.loading||(null!=(u=(c=this.article).blogMeta)&&null!=(u=u.call(c))&&null!=(d=u.isPendingReview)&&d.call(u)&&n.add("review",m("div",{className:"Post-body"},m("blockquote",{class:"uncited",style:{fontSize:"16px"}},m("div",null,m(C(),{name:"far fa-clock",style:{marginRight:"5px"}})," ",a().translator.trans("vadkuz-flarum2-blog.forum.review_article.pending_review")))),60),l&&n.add("post",m(vt(),{post:l}),40)),n}contentItems(){var t,e,s,o,l,r,i,n,u,c,d,g,h;const f=a().forum.attribute("blogDefaultImage")?"url(".concat(a().forum.attribute("baseUrl"),"/assets/").concat(a().forum.attribute("blogDefaultImage"),")"):null,p=null!=(t=this.article)&&null!=(t=t.blogMeta())&&null!=(e=t.featuredImage)&&e.call(t)?"url(".concat(this.article.blogMeta().featuredImage(),")"):f,b=new(D());return b.add("image",m("div",{className:x()("FlarumBlog-Article-Image FlarumBlog-default-image",{"FlarumBlog-Article-GhostImage":this.loading}),style:{backgroundImage:p,opacity:null!=(s=this.article)&&null!=(o=s.isHidden)&&o.call(s)?.4:null}}),100),this.article&&(null!=(l=a().session.user)&&null!=(r=l.canEdit)&&r.call(l)||null!=(i=this.article)&&null!=(n=i.canRename)&&n.call(i)||null!=(u=this.article)&&null!=(c=u.posts)&&null!=(c=c.call(u))&&null!=(c=c[0])&&null!=(d=c.canEdit)&&d.call(c))&&b.add("editArticle",m(St,{article:this.article}),80),b.add("categories",m("div",{className:"FlarumBlog-Article-Categories"},!this.loading&&(null==(g=this.article)||null==(h=g.tags)||null==(h=h.call(g))?void 0:h.map(t=>m(B(),{href:a().route("blogCategory",{slug:t.slug()})},t.name()))),this.loading&&[0,1].map(()=>m("span",{className:"FlarumBlog-Article-GhostCategory"},"Category"))),60),b.add("post",m("div",{className:"FlarumBlog-Article-Post"},this.postItems().toArray()),40),b}articleItems(){var t,e,s,o;const l=new(D());var r,i;return l.add("content",m("div",{className:"FlarumBlog-Article-Content"},this.contentItems().toArray()),100),null!=this&&null!=(t=this.article)&&null!=(e=t.isLocked)&&e.call(t)&&1===(null==this||null==(s=this.article)||null==(o=s.commentCount)?void 0:o.call(s))||l.add("comments",m("div",{className:"FlarumBlog-Article-Comments"},!this.loading&&a().session.user&&this.article.subscription&&(!this.article.isLocked||this.article.isLocked&&!this.article.isLocked())&&m(Dt,{discussion:this.article}),m("h4",null,a().translator.trans("vadkuz-flarum2-blog.forum.comment_section.comments")," (",this.article?this.article.commentCount()-1:0,")"),!this.loading&&(null==(r=this.article)||null==(i=r.isLocked)?void 0:i.call(r))&&m("div",{className:"Post-body"},m("blockquote",{class:"uncited"},m("div",null,m("span",{className:"far fa-lock",style:{marginRight:"5px"}})," ",a().translator.trans("vadkuz-flarum2-blog.forum.comment_section.locked")))),!this.loading&&this.article&&this.PostStream&&m(this.PostStream,{discussion:this.article,stream:this.stream,onPositionChange:this.positionChanged.bind(this)})),75),l}view(){return[1==a().forum.attribute("blogAddHero")&&c().prototype.hero(),m("div",{className:"FlarumBlogItem"},m("div",{className:"container"},m("div",{className:"FlarumBlog-ToolButtons"},m(B(),{href:a().route("blog"),className:"Button",onclick:t=>{a().previous.matches(E)&&(t.preventDefault(),history.back())}},m("i",{class:"icon fas fa-angle-left Button-icon"}),m("span",{class:"Button-label"},a().translator.trans("vadkuz-flarum2-blog.forum.return_to_overview")))),m("div",{className:"FlarumBlog-Article"},m("div",{className:"FlarumBlog-Article-Container"},this.articleItems().toArray()),m(Pt,{article:this.article,loading:this.loading}))))]}positionChanged(t,e){const s=this.article;a().session.user&&e>(s.lastReadPostNumber()||0)&&(s.save({lastReadPostNumber:e}),m.redraw())}}flarum.reg.add("vadkuz-flarum2-blog","forum/pages/BlogItem",Tt),a().initializers.add("vadkuz-flarum2-blog",t=>{t.routes.blog={path:"/blog",component:E},t.routes.blogCategory={path:"/blog/category/:slug",component:E},t.routes.blogComposer={path:"/blog/compose",component:gt},t.routes.blogArticle={path:"/blog/:id",component:Tt},t.routes["blogArticle.near"]={path:"/blog/:id/:near",component:Tt},t.store.models.blogMeta=j,n().prototype.blogMeta=o().hasOne("blogMeta"),r().prototype.isBlog=o().attribute("isBlog"),function(){const t=(t,e)=>{var a,s,o,l;if(!t||!Array.isArray(e)||0===e.length)return!1;const r=parseInt(null==(a=t.id)?void 0:a.call(t),10),i=null!=(s=t.parent)&&s.call(t)?parseInt(null==(o=(l=t.parent()).id)?void 0:o.call(l),10):null;return e.includes(r)||null!==i&&e.includes(i)};(0,H.extend)(c().prototype,"oncreate",function(){const e="function"==typeof a().currentTag?a().currentTag():null,s="both"===a().forum.attribute("blogRedirectsEnabled")||"tags_only"===a().forum.attribute("blogRedirectsEnabled");if(e&&s){const s=a().forum.attribute("blogTags")||[];t(e,s)&&m.route.set(a().route("blog"))}}),(0,H.override)(G().prototype,"show",function(e,s){if(("both"===a().forum.attribute("blogRedirectsEnabled")||"discussions_only"===a().forum.attribute("blogRedirectsEnabled"))&&s&&s.tags().length>0){const e=a().forum.attribute("blogTags")||[];if(s.tags().filter(a=>t(a,e)).length>0){const t=a().route("blogArticle",{id:s.slug()});return m.route.set(t,null,{replace:!0}),null}}return e(s)})}(),J(),Q(),pt()},-1e5)})(),module.exports={}})();
//# sourceMappingURL=forum.js.map