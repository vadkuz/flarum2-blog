(()=>{var t={n:a=>{var e=a&&a.__esModule?()=>a.default:()=>a;return t.d(e,{a:e}),e},d:(a,e)=>{for(var o in e)t.o(e,o)&&!t.o(a,o)&&Object.defineProperty(a,o,{enumerable:!0,get:e[o]})},o:(t,a)=>Object.prototype.hasOwnProperty.call(t,a)};(()=>{"use strict";const a=flarum.reg.get("core","forum/app");var e=t.n(a);const o=flarum.reg.get("core","common/Model");var s=t.n(o);const l=flarum.reg.get("flarum-tags","common/models/Tag");var r=t.n(l);const i=flarum.reg.get("core","common/models/Discussion");var n=t.n(i);const u=flarum.reg.get("core","forum/components/IndexPage");var c=t.n(u);const d=flarum.reg.get("core","common/components/Page");var g=t.n(d);const f=flarum.reg.get("core","common/components/Button");var h=t.n(f);const p=flarum.reg.get("core","common/Component");var b=t.n(p);const v=flarum.reg.get("core","common/components/Link");var _=t.n(v);class k extends(b()){oninit(t){super.oninit(t),this.blogCategories=app.forum.attribute("blogTags")}view(){return m("div",{className:"BlogCategories BlogSideWidget"},m("h3",null,app.translator.trans("vadkuz-flarum2-blog.forum.categories")),this.blogCategories&&this.blogCategories.map(t=>{const a=app.store.getById("tags",t);if(!a)return null;const e=[];let o=1===this.blogCategories.length||a.slug()===m.route.param("slug");return app.store.all("tags").forEach(t=>{t.isChild()&&t.parent()===a&&(t.slug()===m.route.param("slug")&&(o=!0),e.push(this.categoryItem(t)))}),o?[this.categoryItem(a),...e]:this.categoryItem(a)}))}categoryItem(t){return m(_(),{href:app.route("blogCategory",{slug:t.slug()}),className:"BlogSideWidget-item BlogSideWidget-item-".concat(t.id()," ").concat(t.isChild()&&1==app.forum.attribute("blogCategoryHierarchy")?"BlogSideWidget-item-child":"")},m("span",{className:""===t.icon()?"BlogSideWidget-item-colored":"",style:{backgroundColor:""===t.icon()?t.color():null}},m("i",{className:t.icon()})),t.name())}}flarum.reg.add("vadkuz-flarum2-blog","forum/components/BlogCategories",k);const B=flarum.reg.get("core","forum/components/IndexSidebar");var z=t.n(B);const w=flarum.reg.get("core","common/components/SelectDropdown");var y=t.n(w);class N extends(b()){view(){return m("div",{className:"BlogForumNav BlogSideWidget"},m("h3",null,e().translator.trans("vadkuz-flarum2-blog.forum.forum_nav")),m("nav",{className:"IndexPage-nav sideNav"},m(y(),{buttonClassName:"Button",className:"App-titleControl"},this.navItems().toArray())))}navItems(){return z().prototype.navItems()}}flarum.reg.add("vadkuz-flarum2-blog","forum/components/ForumNav",N);const A=flarum.reg.get("core","common/components/Tooltip");var I=t.n(A);const F=flarum.reg.get("core","common/components/Icon");var C=t.n(F);const M=flarum.reg.get("core","common/helpers/humanTime");var x=t.n(M);const S=flarum.reg.get("core","common/utils/classList");var P=t.n(S);const L=flarum.reg.get("core","common/utils/ItemList");var D=t.n(L);class T extends(b()){titleItems(){var t,a,o,s;const{article:l}=this.attrs,r=new(D());return r.add("title",m("[",null,l.title()),100),(null!=(t=l.blogMeta())&&null!=(a=t.isPendingReview)&&a.call(t)||l.isHidden())&&r.add("hidden",m(C(),{name:"fas fa-eye-slash",className:"BlogList-item-hidden"}),80),null!=(o=l.blogMeta())&&null!=(s=o.isPendingReview)&&s.call(o)&&r.add("pendingReview",m(I(),{text:e().translator.trans("vadkuz-flarum2-blog.forum.review_article.pending_review")},m(C(),{name:"far fa-clock",className:"BlogList-item-pendingReview"})),40),r}dataItems(){var t,a;const{article:o}=this.attrs,s=new(D());return s.add("createdAt",m("span",{class:"BlogList-item-details-createdAt"},m(C(),{name:"far fa-clock"})," ",x()(o.createdAt())),100),s.add("author",m("span",{class:"BlogList-item-details-author"},m(C(),{name:"far fa-user"})," ",(null==(t=o.user())||null==(a=t.displayName)?void 0:a.call(t))||e().translator.trans("core.lib.username.deleted_text")),80),s.add("replies",m("span",{class:"BlogList-item-details-replies"},m(C(),{name:"far fa-comment"})," ",(o.commentCount()||1)-1),60),s}contentItems(){var t,a;const{article:e}=this.attrs,o=(null==(t=e.blogMeta())||null==(a=t.summary)?void 0:a.call(t))||"",s=new(D());return s.add("title",m("h4",null,this.titleItems().toArray()),100),o&&s.add("summary",m("p",null,o),80),s.add("data",m("div",{class:"data"},this.dataItems().toArray()),60),s}getImage(){var t,a;const{article:e,defaultImage:o}=this.attrs;return null!=(t=e.blogMeta())&&null!=(a=t.featuredImage)&&a.call(t)?"url(".concat(e.blogMeta().featuredImage(),")"):o}view(t){var a,o;const{article:s,defaultImage:l}=this.attrs,r=this.getImage(),i=null==(a=s.blogMeta())||null==(o=a.isSized)?void 0:o.call(a);return m(_(),{href:e().route("blogArticle",{id:"".concat(s.slug())}),className:P()("BlogList-item",{"BlogList-item-sized":i,"BlogList-item-default":!i},s.tags().map(t=>"BlogList-item-category-".concat(t.id())))},m("div",{class:P()("BlogList-item-photo",{"FlarumBlog-default-image":r===l}),style:{backgroundImage:r}}),m("div",{class:"BlogList-item-content"},this.contentItems().toArray()))}}flarum.reg.add("vadkuz-flarum2-blog","forum/components/BlogOverviewItem",T);class R extends(b()){topItems(){var t,a,o,s,l,r;const{article:i}=this.attrs,n=new(D());return n.add("tags",m("span",{class:"BlogFeatured-list-item-tags"},null==(t=i.tags())?void 0:t.map(t=>m("span",{class:"dataItem"},t.name()))),100),null!=(a=i.isSticky)&&a.call(i)&&n.add("sticky",m("span",{class:"BlogFeatured-list-item-isSticky dataItem"},m(C(),{name:"fas fa-thumbtack"})),80),(null!=(o=i.blogMeta())&&null!=(s=o.isPendingReview)&&s.call(o)||i.isHidden())&&n.add("hidden",m("span",{class:"BlogFeatured-list-item-isHidden dataItem"},m(C(),{name:"fas fa-eye-slash"})),60),null!=(l=i.blogMeta())&&null!=(r=l.isPendingReview)&&r.call(l)&&n.add("pendingReview",m(I(),{text:e().translator.trans("vadkuz-flarum2-blog.forum.review_article.pending_review"),position:"bottom"},m("span",{class:"BlogFeatured-list-item-pendingReview dataItem"},m(C(),{name:"far fa-clock"})," ",e().translator.trans("vadkuz-flarum2-blog.forum.review_article.pending_review_title"))),40),n}dataItems(){var t;const{article:a}=this.attrs,o=new(D());return o.add("createdAt",m("span",{class:"BlogFeatured-list-item-details-createdAt"},m(C(),{name:"far fa-clock"})," ",x()(a.createdAt())),100),o.add("author",m("span",{class:"BlogFeatured-list-item-details-author"},m(C(),{name:"far fa-user"})," ",(null==(t=a.user())?void 0:t.displayName())||e().translator.trans("core.lib.username.deleted_text")),80),o.add("replies",m("span",{class:"BlogFeatured-list-item-details-replies"},m(C(),{name:"far fa-comment"})," ",a.commentCount()-1),60),o}view(t){var a,o;const{article:s,defaultImage:l}=this.attrs,r=null!=(a=s.blogMeta())&&null!=(o=a.featuredImage)&&o.call(a)?"url(".concat(s.blogMeta().featuredImage(),")"):l;return m(_(),{href:e().route("blogArticle",{id:"".concat(s.slug())}),className:P()("BlogFeatured-list-item",s.tags().map(t=>"BlogFeatured-list-item-category-".concat(t.id())),"FlarumBlog-default-image"),style:{backgroundImage:r}},m("div",{class:"BlogFeatured-list-item-top"},this.topItems().toArray()),m("div",{className:"BlogFeatured-list-item-details"},m("h4",null,s.title()),m("div",{className:"data"},this.dataItems().toArray())))}}flarum.reg.add("vadkuz-flarum2-blog","forum/components/FeaturedBlogItem",R);class E extends(g()){oninit(t){super.oninit(t),e().setTitle(e().translator.trans("vadkuz-flarum2-blog.forum.blog")),this.bodyClass="BlogOverviewPage",this.isLoading=!0,this.featuredPosts=[],this.posts=[],this.hasMore=null,this.isLoadingMore=!1,this.languages=e().store.all("discussion-languages"),this.currentSelectedLanguage=m.route.param("lang")?m.route.param("lang"):e().translator.formatter.locale,e().history.push("blog"),this.loadBlogOverview(),this.featuredCount=parseInt(e().forum.attribute("blogFeaturedCount")),this.showCategories=!0,this.showForumNav=!0}loadBlogOverview(){const t=e().preloadedApiDocument();t?setTimeout(this.show.bind(this,t),0):this.reloadData(),m.redraw()}reloadData(){const t={blog:"1"};m.route.param("slug")&&(t.tag=m.route.param("slug")),null!==this.languages&&this.languages.length>=1&&(t.language=this.currentSelectedLanguage),e().store.find("discussions",{filter:t,sort:"-createdAt"}).then(this.show.bind(this)).catch(()=>{m.redraw()})}show(t){if(0===t.length)return this.isLoading=!1,void m.redraw();this.hasMore=t.payload.links&&t.payload.links.next?t.payload.links.next:null,this.featuredPosts=t.slice(0,this.featuredCount),this.posts=t.length>this.featuredCount?t.slice(this.featuredCount,t.length):[],this.isLoading=!1,m.redraw()}loadMore(){this.isLoadingMore=!0,e().store.find(this.hasMore.replace(e().forum.attribute("apiUrl"),"")).then(t=>{t.map(t=>this.posts.push(t)),this.hasMore=t.payload.links&&t.payload.links.next?t.payload.links.next:null}).catch(()=>{}).then(()=>{this.isLoadingMore=!1,m.redraw()})}title(){if(!m.route.param("slug"))return m("h2",null,e().translator.trans("vadkuz-flarum2-blog.forum.recent_posts"));const t=e().store.all("tags").filter(t=>t.slug()===m.route.param("slug"));return m("h2",null,t&&t[0]&&t[0].name(),m("small",null," ","- ",m(_(),{href:e().route("blog")},e().translator.trans("vadkuz-flarum2-blog.forum.return_to_overview"))))}view(){const t=e().forum.attribute("blogDefaultImage")?"url(".concat(e().forum.attribute("baseUrl")+"/assets/"+e().forum.attribute("blogDefaultImage"),")"):null;let a;const o=flarum.extensions["fof-discussion-language"];return o&&o.components&&o.components.LanguageDropdown&&(a=o.components.LanguageDropdown),[1==e().forum.attribute("blogAddHero")&&c().prototype.hero(),m("div",{className:"FlarumBlogOverview"},m("div",{className:"container"},m("div",{className:"BlogFeatured"},m("div",{className:"BlogOverviewButtons"},e().forum.attribute("canWriteBlogPosts")&&m(h(),{className:"Button",onclick:()=>this.newArticle(),icon:"fas fa-pencil-alt"},e().translator.trans("vadkuz-flarum2-blog.forum.compose.write_article")),null!==this.languages&&this.languages.length>=1&&m(a,{selected:this.currentSelectedLanguage,onclick:t=>{"string"==typeof t&&(this.currentSelectedLanguage=t,m.route.set(document.location.pathname,{lang:t}),this.reloadData())}})),this.title(),m("div",{style:{clear:"both"}}),m("div",{class:"BlogFeatured-list"},this.isLoading&&[...new Array(this.featuredCount).fill(void 0)].map(()=>m("div",{class:"BlogFeatured-list-item BlogFeatured-list-item-ghost"},m("div",{class:"BlogFeatured-list-item-details"},m("h4",null," "),m("div",{class:"data"},m("span",null,m("i",{class:"far fa-wave"})))))),!this.isLoading&&this.featuredPosts.length>=0&&this.featuredPosts.map(a=>m(R,{article:a,defaultImage:t})))),m("div",{className:"BlogScrubber"},m("div",{className:"BlogList"},this.isLoading&&[!1,!1,!0,!1].map(t=>m("div",{className:"BlogList-item BlogList-item-".concat(!0===t?"sized":"default"," BlogList-item-ghost")},m("div",{className:"BlogList-item-photo FlarumBlog-default-image"}),m("div",{className:"BlogList-item-content"},m("h4",null," "),m("p",null," "),m("div",{className:"data"},m("span",null,m("i",{className:"far fa-wave"})))))),!this.isLoading&&this.posts.length>=1&&this.posts.map(a=>m(T,{article:a,defaultImage:t})),!this.isLoading&&this.featuredPosts.length>0&&null===this.hasMore&&m("p",{className:"FlarumBlog-reached-end"},e().translator.trans("vadkuz-flarum2-blog.forum.no_more_posts")),!this.isLoading&&0===this.featuredPosts.length&&0===this.posts.length&&m("p",{className:"FlarumBlog-reached-end"},e().translator.trans("vadkuz-flarum2-blog.forum.category_empty")),!this.isLoading&&null!==this.hasMore&&m("div",{className:"FlarumBlog-reached-load-more"},m(h(),{className:"Button",onclick:()=>this.loadMore(),icon:"fas fa-chevron-down",loading:this.isLoadingMore},e().translator.trans("core.forum.discussion_list.load_more_button")))),m("div",{className:"Sidebar"},this.showCategories&&m(k,null),this.showForumNav&&m(N,null)))))]}newArticle(){let t=[];const a=e().store.getBy("tags","slug",m.route.param("slug"));a&&t.push(a),m.route.set(e().route("blogComposer",{tags:t.map(t=>t.id()).join(),lang:this.languages.length>0?this.currentSelectedLanguage:void 0}))}}flarum.reg.add("vadkuz-flarum2-blog","forum/pages/BlogOverview",E);const O=flarum.reg.get("core","forum/components/DiscussionPage");var G=t.n(O);const H=flarum.reg.get("core","common/extend"),W=flarum.reg.get("core","common/utils/mixin");var U=t.n(W);class q extends(U()(s(),{discussion:s().hasOne("discussion"),featuredImage:s().attribute("featuredImage"),summary:s().attribute("summary"),isFeatured:s().attribute("isFeatured"),isSized:s().attribute("isSized"),isPendingReview:s().attribute("isPendingReview")})){}flarum.reg.add("vadkuz-flarum2-blog","common/Models/BlogMeta",q);const j=flarum.reg.get("flarum-tags","forum/components/TagsPage");var V=t.n(j);function J(){(0,H.extend)(V().prototype,"view",function(t){if(this.loading)return t;if(0==app.forum.attribute("blogHideTags"))return t;const a=app.forum.attribute("blogTags")||[],e=K(t,"TagsPage-content",!0),o=null==e?void 0:e.children[0];return e&&o?(o.children=o.children.map((t,e)=>a.indexOf(this.tags[e].id())>=0?null:t),t):t}),(0,H.extend)(c().prototype,"navItems",function(t){return 0==app.forum.attribute("blogHideTags")||(app.forum.attribute("blogTags")||[]).forEach(a=>{t.remove("tag".concat(a))}),t})}function K(t,a,e,o,s){void 0===e&&(e=!1),void 0===o&&(o=50),void 0===s&&(s=0);const l=function(t){if(Array.isArray(t))return t;const a=(null==t?void 0:t.children)||[];return Array.isArray(a)?a:[]}(t);let r=null;for(let t=0;t<l.length;t++){var i;if(((null==(i=l[t])||null==(i=i.attrs)?void 0:i.className)||"").includes(a)){r=l[t];break}}if(e&&!r&&s<o)for(let t of l){const e=K(t,a,!0,o,s+1);if(e)return e}return r}function Q(){const t=app.route.discussion;app.route.discussion=(a,e)=>{let o=!1;if(("both"===app.forum.attribute("blogRedirectsEnabled")||"discussions_only"===app.forum.attribute("blogRedirectsEnabled"))&&a.tags().length>0){const t=(app.forum.attribute("blogTags")||[]).map(t=>parseInt(t,10)).filter(t=>Number.isInteger(t)),e=a.tags().filter(a=>((t,a)=>{var e,o,s,l;const r=parseInt(null==(e=t.id)?void 0:e.call(t),10),i=null!=(o=t.parent)&&o.call(t)?parseInt(null==(s=(l=t.parent()).id)?void 0:s.call(l),10):null;return a.includes(r)||null!==i&&a.includes(i)})(a,t));e.length>0&&(o=!0)}return o?a.lastReadPostNumber()>1?app.route("blogArticle.near",{id:a.slug(),near:a.lastReadPostNumber()}):app.route("blogArticle",{id:a.slug()}):t(a,e)}}flarum.reg.add("vadkuz-flarum2-blog","forum/utils/extendTagOverview",J);const X=flarum.reg.get("core","common/helpers/listItems");var Y=t.n(X);const Z=flarum.reg.get("core","common/components/Avatar");var $=t.n(Z);class tt extends(b()){view(){const t=this.attrs.loading?null:this.attrs.article?this.attrs.article.user():this.attrs.user;return m("div",{className:"FlarumBlog-Article-Author"},m("div",{className:"FlarumBlog-Article-Author-background ".concat(this.attrs.loading?"FlarumBlog-Author-Ghost":""),style:{backgroundColor:t&&t.color()?t.color():null}}),m("div",{className:"FlarumBlog-Article-Author-Avatar"},t?m(_(),{href:app.route("user",{username:t.username()})},m($(),{user:t})):m("span",{className:"Avatar FlarumBlog-Author-Ghost"})),t&&m("div",{className:"FlarumBlog-Article-Author-Info"},m(_(),{href:app.route("user",{username:t.username()}),className:"FlarumBlog-Article-Author-Name"},t.displayName()),m("p",{className:"FlarumBlog-Article-Author-Bio"},t.bio&&t.bio()),m("ul",{className:"FlarumBlog-Article-Author-Extended"},Y()(this.items().toArray()))),this.attrs.loading&&m("div",null,m("span",{className:"FlarumBlog-Article-Author-Name FlarumBlog-Author-Ghost"}," "),m("p",{className:"FlarumBlog-Article-Author-Bio FlarumBlog-Author-Ghost"}," "),m("p",{className:"FlarumBlog-Article-Author-Bio FlarumBlog-Author-Ghost"}," "),m("p",{className:"FlarumBlog-Article-Author-Bio FlarumBlog-Author-Ghost"}," ")))}items(){return new(D())}}flarum.reg.add("vadkuz-flarum2-blog","forum/components/BlogItemSidebar/BlogAuthor",tt);const at=flarum.reg.get("core","common/components/Modal");var et=t.n(at);const ot=flarum.reg.get("core","common/utils/Stream");var st=t.n(ot);class lt extends(et()){oninit(t){super.oninit(t),this.article=this.attrs.article,this.name=st()(this.article.title()||""),this.redirect=this.attrs.redirect}className(){return"Modal--small Support-Modal"}title(){return app.translator.trans("vadkuz-flarum2-blog.forum.tools.rename_article")}content(){return m("div",{className:"Modal-body"},m("form",{className:"Form",onsubmit:this.onsubmit.bind(this)},this.fields().toArray()))}fields(){const t=new(D());return t.add("name",m("div",{className:"Form-group"},m("label",null,app.translator.trans("vadkuz-flarum2-blog.forum.article.title"),":"),m("input",{className:"FormControl",placeholder:app.translator.trans("vadkuz-flarum2-blog.forum.article.title"),bidi:this.name})),50),t.add("submit",m("div",{className:"Form-group"},h().component({type:"submit",className:"Button Button--primary SupportModal-save",loading:this.loading},app.translator.trans("core.forum.composer_edit.submit_button"))),-10),t}submitData(){return{title:this.name()}}onsubmit(t){if(t.preventDefault(),this.loading=!0,this.attrs.onChange)return this.attrs.onChange(this.name()),void this.hide();this.article.save({title:this.name()}).then(()=>{if(this.hide(),this.redirect){const t="/blog/".concat(this.article.slug());m.route.set(t,!0),window.history.replaceState(null,document.title,t)}},t=>{this.loading=!1,this.handleErrors(t)})}}flarum.reg.add("vadkuz-flarum2-blog","forum/components/Modals/RenameArticleModal",lt);const rt=flarum.reg.get("core","common/components/Switch");var it=t.n(rt);flarum.reg.add("vadkuz-flarum2-blog","forum/utils/selectFiles",function(t,a){return new Promise(e=>{let o=document.createElement("input");o.type="file",o.multiple=a,o.accept=t,o.onchange=t=>{let s=Array.from(o.files||[]);e(a?s:s[0])},o.click()})});class nt extends(et()){oninit(t){super.oninit(t),this.attrs.article?this.meta=this.attrs.article&&this.attrs.article.blogMeta()?this.attrs.article.blogMeta():e().store.createRecord("blogMeta"):this.meta=this.attrs.meta?this.attrs.meta:e().store.createRecord("blogMeta"),this.isNew=!this.meta.exists,this.summary=st()(this.meta.summary()||""),this.featuredImage=st()(this.meta.featuredImage()||""),this.isFeatured=st()(this.meta.isFeatured()||!1),this.isSized=st()(this.meta.isSized()||!1),this.isPendingReview=st()(this.meta.isPendingReview()||!1)}className(){return"Modal--small Support-Modal"}title(){return e().translator.trans("vadkuz-flarum2-blog.forum.article_settings.title")}content(){return m("div",{className:"Modal-body"},m("form",{className:"Form",onsubmit:this.onsubmit.bind(this)},this.fields().toArray()))}fields(){const t=new(D());t.add("summary",m("div",{className:"Form-group"},m("label",null,e().translator.trans("vadkuz-flarum2-blog.forum.article_settings.fields.summary.title"),":"),m("textarea",{className:"FormControl",style:{maxWidth:"100%",minWidth:"100%",width:"100%",minHeight:"120px"},bidi:this.summary,placeholder:e().translator.trans("vadkuz-flarum2-blog.forum.article_settings.fields.summary.placeholder")}),m("small",null,e().translator.trans("vadkuz-flarum2-blog.forum.article_settings.fields.summary.helper_text"))),30);let a=null;if("fof-upload"in flarum.extensions&&e().forum.attribute("fof-upload.canUpload")){const t=flarum.extensions["fof-upload"],o=t&&t.components?t.components.Uploader:null,s=t&&t.components?t.components.FileManagerModal:null;if(o&&s){const t=new o;a=m(h(),{class:"Button Button--icon",onclick:async()=>{e().modal.show(s,{uploader:t,onSelect:t=>{const a=e().store.getById("files",t[0]);this.featuredImage(a.url())}},!0)},icon:"fas fa-cloud-upload-alt"})}}return t.add("image",m("div",{className:"Form-group VadkuzBlog-ArticleImage"},m("label",null,e().translator.trans("vadkuz-flarum2-blog.forum.article_settings.fields.image.title"),":"),m("div",{"data-upload-enabled":!!a},m("input",{type:"text",className:"FormControl",bidi:this.featuredImage,placeholder:"https://"}),a),m("small",null,e().translator.trans("vadkuz-flarum2-blog.forum.article_settings.fields.image.helper_text")),""!==this.featuredImage()&&m("img",{src:this.featuredImage(),alt:"Article image",title:e().translator.trans("vadkuz-flarum2-blog.forum.article_settings.fields.image.title"),style:{width:"100%",marginTop:"15px"}})),30),t.add("sized",m("div",{className:"Form-group"},it().component({state:1==this.isSized(),onchange:t=>{this.isSized(t)}},[m("b",null,e().translator.trans("vadkuz-flarum2-blog.forum.article_settings.fields.highlight.title")),m("div",{className:"helpText",style:{fontWeight:500}},e().translator.trans("vadkuz-flarum2-blog.forum.article_settings.fields.highlight.helper_text"))])),-10),t.add("submit",m("div",{className:"Form-group"},h().component({type:"submit",className:"Button Button--primary SupportModal-save",loading:this.loading},e().translator.trans("core.forum.composer_edit.submit_button"))),-10),t}submitData(){return{summary:this.summary(),featuredImage:this.featuredImage(),isFeatured:this.isFeatured(),isSized:this.isSized(),isPendingReview:this.isPendingReview(),relationships:this.isNew&&!this.attrs.isComposer?{discussion:this.attrs.article}:null}}onsubmit(t){if(t.preventDefault(),this.attrs.onsubmit)return this.meta.pushData({attributes:this.submitData()}),this.attrs.onsubmit(this.meta),void this.hide();this.loading=!0,this.meta.save(this.submitData()).then(()=>{this.attrs.article&&this.attrs.article.pushData({relationships:{blogMeta:this.meta}}),this.hide(),m.redraw()},t=>{this.loading=!1,this.handleErrors(t)})}}flarum.reg.add("vadkuz-flarum2-blog","forum/components/Modals/BlogPostSettingsModal",nt);const mt=flarum.reg.get("core","common/components/TextEditor");var ut=t.n(mt);class ct extends(b()){view(){return m("div",null)}oncreate(t){super.oncreate(t),s9e.TextFormatter.preview(t.attrs.content||"",t.dom)}}flarum.reg.add("vadkuz-flarum2-blog","forum/components/Composer/ComposerPreview",ct);class dt extends(b()){oninit(t){super.oninit(t),this.composer=this.attrs.composer,this.previewContent=!1}view(){var t,a;this.composer=this.attrs.composer;const o=null!=(t=this.composer)&&null!=(t=t.fields)&&t.content?this.composer.fields.content():"",s=""!==o,l=!!this.attrs.disabled;return m("div",{className:"Flarum-Blog-Composer ".concat(l?"Flarum-Blog-Composer-Loading":"")},m("div",{className:"Flarum-Blog-Composer-tabs"},m(h(),{className:!this.previewContent&&"AricleComposerButtonSelected",onclick:()=>this.previewContent=!1},e().translator.trans("vadkuz-flarum2-blog.forum.composer.write")),m(h(),{className:this.previewContent&&"AricleComposerButtonSelected",onclick:()=>this.previewContent=!0},e().translator.trans("vadkuz-flarum2-blog.forum.composer.view"))),m("div",{className:"Composer Flarum-Blog-Composer-body ".concat(this.previewContent?"Flarum-Blog-Composer-HideEditor":"")},this.previewContent&&m("div",{className:"Flarum-Blog-Composer-preview"},!s&&e().translator.trans("vadkuz-flarum2-blog.forum.composer.nothing_to_preview"),m(ct,{content:this.composer.fields.content()})),ut().component({submitLabel:this.attrs.submitLabel||e().translator.trans("core.forum.composer_edit.submit_button"),placeholder:this.attrs.placeholder,disabled:l,composer:this.composer,onchange:null==(a=this.composer)||null==(a=a.fields)?void 0:a.content,onsubmit:this.onsubmit.bind(this),value:o})))}onsubmit(){this.attrs.onsubmit&&this.attrs.onsubmit()}}flarum.reg.add("vadkuz-flarum2-blog","forum/components/Composer/Composer",dt);class gt extends(g()){oninit(t){if(super.oninit(t),e().setTitle(e().translator.trans("vadkuz-flarum2-blog.forum.blog")),e().forum.attribute("canWriteBlogPosts")){if(e().history.push("blogComposer"),this.languages=e().store.all("discussion-languages")||[],this.bodyClass="BlogItemPage BlogItemPage--composer",this.articleLanguage=st()(m.route.param("lang")?m.route.param("lang"):e().translator.locale),this.article=e().store.createRecord("discussions"),this.blogMeta=null,this.tags=[],m.route.param().tags){const t=Array.isArray(m.route.param().tags)?m.route.param().tags:m.route.param().tags.split(",");m.route.param().tags.length>0&&t.forEach(t=>{const a=e().store.getById("tags",t);a&&this.tags.push(a)})}this.isSaving=!1}else m.route.set(e().route("blog"))}openTagsModal(t){void 0===t&&(t=null),t&&t.preventDefault(),this.isSaving||e().modal.show(()=>flarum.reg.asyncModuleImport("ext:flarum/tags/forum/components/TagDiscussionModal"),{selectedTags:this.tags,onsubmit:t=>{this.tags=t}})}openNameArticleModal(t){void 0===t&&(t=null),t&&t.preventDefault(),this.isSaving||e().modal.show(lt,{article:this.article,onChange:t=>{this.article.pushData({attributes:{title:t}})}})}openBlogSettings(t){t.preventDefault(),this.isSaving||e().modal.show(nt,{meta:this.blogMeta,onsubmit:t=>this.blogMeta=t})}view(){return m("div",{className:"FlarumBlogItem"},m("div",{className:"container"},this.pageItems().toArray()))}pageItems(){const t=new(D());return t.add("toolButtons",m("div",{className:"FlarumBlog-ToolButtons"},m(_(),{href:e().route("blog"),className:"Button",loading:this.isSaving,icon:"fas fa-angle-left"},m("i",{class:"icon fas fa-angle-left Button-icon"}),m("span",{class:"Button-label"},e().translator.trans("vadkuz-flarum2-blog.forum.return_to_overview")))),100),t.add("article",m("div",{className:"FlarumBlog-Article"},this.articleWrapperItems().toArray()),90),t}articleWrapperItems(){const t=new(D());return t.add("container",m("div",{className:"FlarumBlog-Article-Container"},this.articleItems().toArray()),100),t.add("sidebar",m("div",{className:"FlarumBlog-Article-Sidebar"},m(tt,{user:e().session.user})),90),t}articleItems(){const t=new(D()),a=e().forum.attribute("blogDefaultImage")?"url(".concat(e().forum.attribute("baseUrl")+"/assets/"+e().forum.attribute("blogDefaultImage"),")"):null,o=this.blogMeta&&this.blogMeta.featuredImage()?"url(".concat(this.blogMeta.featuredImage(),")"):a;let s;const l=flarum.extensions["fof-discussion-language"];return l&&l.components&&l.components.LanguageDropdown&&(s=l.components.LanguageDropdown),t.add("content",m("div",{className:"FlarumBlog-Article-Content"},m("div",{className:"FlarumBlog-Article-Image FlarumBlog-default-image",style:{backgroundImage:o,cursor:"pointer"},onclick:t=>this.openBlogSettings(t)}),m("div",{className:"FlarumBlog-Article-Content-Edit-Button"},m("div",{className:0===this.languages.length?"FlarumBlog-Article-Content-Edit-Dropdown":"FlarumBlog-Article-Content-EditButtons"},null!==this.languages&&this.languages.length>=1&&m(s,{selected:this.articleLanguage(),onclick:t=>{"string"==typeof t&&this.articleLanguage(t)}}),m(h(),{className:"Button",onclick:t=>this.openBlogSettings(t),icon:"fas fa-pencil-alt",loading:this.isSaving},e().translator.trans("vadkuz-flarum2-blog.forum.composer.update_settings")))),m("div",{className:"FlarumBlog-Article-Categories"},this.tags.map(t=>m("button",{class:"Button Button--text",onclick:t=>this.openTagsModal(t)},t.name())),m("button",{class:"Button Button--text",onclick:t=>this.openTagsModal(t)},0===this.tags.length?e().translator.trans("vadkuz-flarum2-blog.forum.composer.select_category"):e().translator.trans("vadkuz-flarum2-blog.forum.composer.edit_categories")," ",m("i",{className:"fas fa-edit"}))),m("div",{className:"FlarumBlog-Article-Post"},m("h1",{onclick:()=>this.openNameArticleModal(),className:"FlarumBlog-Article-Title",style:{cursor:"pointer"}},this.article&&this.article.title()&&""!==this.article.title()?this.article.title():e().translator.trans("vadkuz-flarum2-blog.forum.composer.no_title"),m("button",{class:"Button Button--text",onclick:t=>t.preventDefault()},m("i",{className:"fas fa-edit"}))),m("div",{className:"Post-body"},m(dt,{composer:e().composer,originalContent:"",submitLabel:e().translator.trans("vadkuz-flarum2-blog.forum.composer.post_article"),placeholder:e().translator.trans("vadkuz-flarum2-blog.forum.composer.enter_message_here"),onsubmit:()=>this.create(),disabled:this.isSaving})))),100),t.add("commentsPlaceholder",m("div",{className:"FlarumBlog-Article-Comments"},m("h4",null,e().translator.trans("vadkuz-flarum2-blog.forum.comment_section.comments")," (0)"),m("div",{className:"Post-body"},m("blockquote",{class:"uncited"},m("div",null,m("span",{className:"fas fa-ban",style:{marginRight:"5px"}})," ",e().translator.trans("vadkuz-flarum2-blog.forum.composer.comment_section"))))),90),t}create(){const t=(e().forum.attribute("blogTags")||[]).map(t=>parseInt(t,10)).filter(t=>Number.isInteger(t));if(0===this.tags.length)return void this.openTagsModal();if(!this.article.title()||""===this.article.title())return void this.openNameArticleModal();if(0===this.tags.filter(a=>{var e,o,s,l;const r=parseInt(null==(e=a.id)?void 0:e.call(a),10),i=null!=(o=a.parent)&&o.call(a)?parseInt(null==(s=(l=a.parent()).id)?void 0:s.call(l),10):null;return t.includes(r)||null!==i&&t.includes(i)}).length)return void alert(e().translator.trans("vadkuz-flarum2-blog.forum.composer.no_blog_tags_selected"));if(!(null!==this.blogMeta&&(this.blogMeta.featuredImage()||e().forum.attribute("blogDefaultImage"))&&this.blogMeta.summary()||confirm(e().translator.trans("vadkuz-flarum2-blog.forum.composer.post_without_blog_info"))))return;let a={tags:this.tags};this.languages.length>0&&(a.language=e().store.getBy("discussion-languages","code",this.articleLanguage()));const o={title:this.article.title(),content:e().composer.fields.content(),relationships:a};this.isSaving=!0;const s=null!==this.blogMeta&&(Boolean(this.blogMeta.featuredImage())||Boolean(this.blogMeta.summary())||Boolean(this.blogMeta.isSized()));this.article.save(o).then(t=>(s?e().request({method:"POST",url:"".concat(e().forum.attribute("apiUrl"),"/blogMeta"),body:{data:{type:"blogMeta",attributes:{featuredImage:this.blogMeta.featuredImage(),summary:this.blogMeta.summary(),isSized:this.blogMeta.isSized()},relationships:{discussion:{data:{type:"discussions",id:t.id()}}}}}}).catch(()=>null):Promise.resolve(null)).then(()=>t)).then(t=>{setTimeout(()=>{m.route.set(e().route("blogArticle",{id:"".concat(t.slug())}))},500)}).catch(()=>{this.isSaving=!1,m.redraw()})}}flarum.reg.add("vadkuz-flarum2-blog","forum/pages/BlogComposer",gt);const ft=flarum.reg.get("core","common/components/LinkButton");var ht=t.n(ft);function pt(){(0,H.extend)(z().prototype,"navItems",function(t){return e().forum.attribute("blogAddSidebarNav")&&"0"!==e().forum.attribute("blogAddSidebarNav")&&t.add("blog",m(ht(),{icon:"fas fa-comment",href:e().route("blog")},e().translator.trans("vadkuz-flarum2-blog.forum.blog")),15),t})}flarum.reg.add("vadkuz-flarum2-blog","forum/utils/addSidebarNav",pt);const bt={"vadkuz-flarum2-blog.admin.blog":"Блог","vadkuz-flarum2-blog.admin.select_categories_modal.title":"Выбор категорий блога","vadkuz-flarum2-blog.admin.select_categories_modal.description":"Выберите один или несколько тегов, которые считаются категориями блога.","vadkuz-flarum2-blog.admin.select_categories_modal.visit_blog":"Перейти в блог.","vadkuz-flarum2-blog.admin.select_categories_modal.tag_name":"Название тега","vadkuz-flarum2-blog.admin.select_categories_modal.no_tags":"У вас пока нет тегов.","vadkuz-flarum2-blog.admin.select_categories_modal.save_changes":"Сохранить изменения","vadkuz-flarum2-blog.admin.select_categories_modal.close":"Закрыть","vadkuz-flarum2-blog.admin.permissions.approve_posts":"Может одобрять статьи блога","vadkuz-flarum2-blog.admin.permissions.auto_approve_posts":"Публиковать статьи без одобрения","vadkuz-flarum2-blog.admin.permissions.write_articles":"Писать и редактировать статьи блога","vadkuz-flarum2-blog.admin.settings.add_hero_label":"Показывать приветственный баннер","vadkuz-flarum2-blog.admin.settings.add_hero_text":"Показывать приветственный баннер на страницах блога, пока пользователь его не закрыл.","vadkuz-flarum2-blog.admin.settings.add_sidebar_nav_label":"Добавить в боковую навигацию","vadkuz-flarum2-blog.admin.settings.add_sidebar_nav_text":"Добавить ссылку на блог в боковое меню навигации.","vadkuz-flarum2-blog.admin.settings.allow_comments_label":"Разрешить комментарии","vadkuz-flarum2-blog.admin.settings.allow_comments_text":"По умолчанию разрешены комментарии к записям блога. При отключении их можно включать отдельно для каждой записи. Примечание: изменение этой настройки не влияет на уже существующие записи блога.","vadkuz-flarum2-blog.admin.settings.blog_heading":"Блог","vadkuz-flarum2-blog.admin.settings.categories_heading":"Категории","vadkuz-flarum2-blog.admin.settings.default_article_image_label":"Изображение статьи по умолчанию","vadkuz-flarum2-blog.admin.settings.default_article_image_text":"Выберите изображение по умолчанию, которое будет показываться, если у статьи нет собственного изображения.","vadkuz-flarum2-blog.admin.settings.featured_count_label":"Макс. число избранных постов","vadkuz-flarum2-blog.admin.settings.featured_count_text":"Сколько постов должно отображаться в большой сетке вверху страницы блога?","vadkuz-flarum2-blog.admin.settings.hide_on_discussion_list_label":"Не показывать в списке обсуждений","vadkuz-flarum2-blog.admin.settings.hide_on_discussion_list_text":"Скрывать записи блога из списка обсуждений.","vadkuz-flarum2-blog.admin.settings.hide_tags_in_taglist_label":"Скрыть теги в списке тегов","vadkuz-flarum2-blog.admin.settings.hide_tags_in_taglist_text":"Если включено, это расширение скроет теги блога с главной страницы.","vadkuz-flarum2-blog.admin.settings.no_categories_selected":"Категории не выбраны","vadkuz-flarum2-blog.admin.settings.redirect_articles_label":"Переадресовывать статьи блога","vadkuz-flarum2-blog.admin.settings.redirect_articles_text":"Если включено, расширение будет перенаправлять исходные URL обсуждений на URL статьи в блоге.","vadkuz-flarum2-blog.admin.settings.redirect_tags_label":"Переадресовывать теги блога","vadkuz-flarum2-blog.admin.settings.redirect_tags_text":"Если включено, расширение перенаправляет URL тегов блога на URL категории блога.","vadkuz-flarum2-blog.admin.settings.redirects_heading":"Переадресации","vadkuz-flarum2-blog.admin.settings.require_review_label":"Записи блога требуют модерации","vadkuz-flarum2-blog.admin.settings.require_review_text":"При публикации статья не будет видна сразу и должна быть одобрена модератором.","vadkuz-flarum2-blog.admin.settings.select_categories_button":"Выбрать категории блога","vadkuz-flarum2-blog.admin.settings.selected_category_count":"{count, plural, one {Выбрана # категория} few {Выбрано # категории} many {Выбрано # категорий} other {Выбрано # категории}}","vadkuz-flarum2-blog.admin.settings.show_tag_hierarchy_label":"Показывать иерархию тегов","vadkuz-flarum2-blog.admin.settings.show_tag_hierarchy_text":"Добавляет отступы дочерним категориям и делает список категорий иерархическим.","vadkuz-flarum2-blog.forum.article.slug":"Слаг","vadkuz-flarum2-blog.forum.article.summary":"Краткое описание","vadkuz-flarum2-blog.forum.article.title":"Заголовок","vadkuz-flarum2-blog.forum.article_settings.fields.highlight.helper_text":"Показывать эту статью с большим изображением на странице обзора блога.","vadkuz-flarum2-blog.forum.article_settings.fields.highlight.title":"Выделенная статья","vadkuz-flarum2-blog.forum.article_settings.fields.image.helper_text":"Лучшее разрешение для соцсетей: 1200x630","vadkuz-flarum2-blog.forum.article_settings.fields.image.title":"Изображение статьи","vadkuz-flarum2-blog.forum.article_settings.fields.summary.helper_text":"Это описание отображается на странице обзора блога и используется для SEO.","vadkuz-flarum2-blog.forum.article_settings.fields.summary.placeholder":"Введите краткое описание","vadkuz-flarum2-blog.forum.article_settings.fields.summary.title":"Краткое описание статьи","vadkuz-flarum2-blog.forum.article_settings.title":"Настройки статьи блога","vadkuz-flarum2-blog.forum.blog":"Блог","vadkuz-flarum2-blog.forum.categories":"Категории","vadkuz-flarum2-blog.forum.category_empty":"В этой категории нет записей блога.","vadkuz-flarum2-blog.forum.comment_section.comments":"Комментарии","vadkuz-flarum2-blog.forum.comment_section.locked":"Раздел комментариев отключен для этой статьи","vadkuz-flarum2-blog.forum.compose.write_article":"Написать статью","vadkuz-flarum2-blog.forum.composer.comment_section":"Раздел комментариев недоступен при написании статьи.","vadkuz-flarum2-blog.forum.composer.edit_categories":"Изменить категории","vadkuz-flarum2-blog.forum.composer.enter_message_here":"Введите сообщение","vadkuz-flarum2-blog.forum.composer.no_blog_tags_selected":"Среди выбранных тегов нет блог-тега. Пожалуйста, выберите хотя бы один.","vadkuz-flarum2-blog.forum.composer.no_title":"Без заголовка","vadkuz-flarum2-blog.forum.composer.nothing_to_preview":"Нечего показывать в предпросмотре","vadkuz-flarum2-blog.forum.composer.post_article":"Опубликовать статью","vadkuz-flarum2-blog.forum.composer.post_without_blog_info":"Вы уверены, что хотите опубликовать эту статью? Вы еще не указали краткое описание или изображение.","vadkuz-flarum2-blog.forum.composer.select_category":"Выбрать категорию","vadkuz-flarum2-blog.forum.composer.update_settings":"Обновить настройки блога","vadkuz-flarum2-blog.forum.composer.view":"Предпросмотр","vadkuz-flarum2-blog.forum.composer.write":"Написать","vadkuz-flarum2-blog.forum.forum_nav":"Навигация форума","vadkuz-flarum2-blog.forum.hidden":"Скрыто","vadkuz-flarum2-blog.forum.no_more_posts":"Больше нет записей в блоге.","vadkuz-flarum2-blog.forum.read_more":"Читать далее","vadkuz-flarum2-blog.forum.recent_posts":"Последние записи блога","vadkuz-flarum2-blog.forum.return_to_overview":"Вернуться к обзору блога","vadkuz-flarum2-blog.forum.review_article.approve_article":"Одобрить статью","vadkuz-flarum2-blog.forum.review_article.approve_article_approved":"Статья одобрена и опубликована","vadkuz-flarum2-blog.forum.review_article.pending_review":"Эта статья ожидает проверки и еще не опубликована","vadkuz-flarum2-blog.forum.review_article.pending_review_title":"На модерации","vadkuz-flarum2-blog.forum.tools.approve_article":"Одобрить статью","vadkuz-flarum2-blog.forum.tools.article_settings":"Настройки статьи","vadkuz-flarum2-blog.forum.tools.delete_forever":"Удалить навсегда","vadkuz-flarum2-blog.forum.tools.disable_comments":"Отключить комментарии","vadkuz-flarum2-blog.forum.tools.edit_article":"Редактировать статью","vadkuz-flarum2-blog.forum.tools.enable_comments":"Включить комментарии","vadkuz-flarum2-blog.forum.tools.hide_article":"Скрыть статью","vadkuz-flarum2-blog.forum.tools.manage":"Управление","vadkuz-flarum2-blog.forum.tools.recover_article":"Восстановить статью","vadkuz-flarum2-blog.forum.tools.rename_article":"Переименовать статью","vadkuz-flarum2-blog.forum.tools.update_category":"Обновить категории","vadkuz-flarum2-blog.forum.utils.redirect.link":"<a>Нажмите здесь</a>, если перенаправление не произошло","vadkuz-flarum2-blog.forum.utils.redirect.title":"Перенаправляем вас на статью блога...","vadkuz-flarum2-blog.forum.placeholders.ghost_title":"Черновой заголовок","vadkuz-flarum2-blog.forum.placeholders.ghost_category":"Категория","vadkuz-flarum2-blog.forum.validation.missing_id":"Отсутствует ID"};function vt(t){var a,e,o;const s=String((null==t||null==(a=t.data)?void 0:a.locale)||(null==t||null==(e=t.translator)||null==(o=e.getLocale)?void 0:o.call(e))||"").toLowerCase();("ru"===s||s.startsWith("ru-"))&&t.translator.addTranslations(bt)}flarum.reg.add("vadkuz-flarum2-blog","common/translations/ru",vt);const _t=flarum.reg.get("core","forum/components/CommentPost");var kt=t.n(_t);const Bt=flarum.reg.get("core","forum/states/PostStreamState");var zt=t.n(Bt);const wt=flarum.reg.get("core","forum/utils/DiscussionControls");var yt=t.n(wt);const Nt=flarum.reg.get("core","common/components/Alert");var At=t.n(Nt);const It=flarum.reg.get("core","common/components/Dropdown");var Ft=t.n(It);const Ct=flarum.reg.get("core","forum/components/EditPostComposer");var Mt=t.n(Ct);const xt=flarum.reg.get("core","common/utils/extractText");var St=t.n(xt);class Pt extends(b()){init(){this.loadedPost=!1}openSeoModal(t,a){var o;const s=t=>e().modal.show(a,{objectType:"blogs",objectId:t}),l=null==(o=t.blogMeta)?void 0:o.call(t);l?s(l.id()):e().request({method:"GET",url:"".concat(e().forum.attribute("apiUrl"),"/blogMetaByDiscussion/").concat(t.id())}).then(t=>{var a;const o=null==t||null==(a=t.data)?void 0:a.id;o?s(o):e().alerts.show(At(),{type:"error"},e().translator.trans("core.lib.error.generic_message"))}).catch(()=>{e().alerts.show(At(),{type:"error"},e().translator.trans("core.lib.error.generic_message"))})}manageArticleButtons(){const t=this.attrs.article,a=new(D()),o=flarum.extensions["fof-discussion-language"]&&void 0!==flarum.extensions["fof-discussion-language"].components?flarum.extensions["fof-discussion-language"].components.LanguageDiscussionModal:null;t.canRename()&&a.add("rename",h().component({className:"Button",onclick:()=>e().modal.show(lt,{article:t}),icon:"fas fa-pencil-alt"},e().translator.trans("vadkuz-flarum2-blog.forum.tools.rename_article")),100);const s=t.firstPost();a.add("edit",h().component({className:"Button",disabled:!s||!s.canEdit(),onclick:()=>{e().composer.load(Mt(),{post:s}),e().composer.show()},icon:"fas fa-edit"},e().translator.trans("vadkuz-flarum2-blog.forum.tools.edit_article")),90),a.add("articleSettings",h().component({className:"Button",onclick:()=>e().modal.show(nt,{article:t}),icon:"fas fa-cogs"},e().translator.trans("vadkuz-flarum2-blog.forum.tools.article_settings")),80),t.canTag()&&a.add("tag",h().component({className:"Button",onclick:()=>e().modal.show(()=>flarum.reg.asyncModuleImport("ext:flarum/tags/forum/components/TagDiscussionModal"),{discussion:t}),icon:"fas fa-tag"},e().translator.trans("vadkuz-flarum2-blog.forum.tools.update_category")),70);const l=flarum.extensions["vadkuz-flarum2-seo"],r=l&&l.components?l.components.MetaSeoModal:null;return r&&e().forum.attribute("canConfigureSeo")&&a.add("seo",h().component({className:"Button",onclick:()=>this.openSeoModal(t,r),icon:"fas fa-search"},e().translator.trans("vadkuz-flarum2-seo.forum.controls.configure_seo")),70),t.blogMeta()&&t.blogMeta().isPendingReview()&&(a.add("separator1",m("li",{className:"Dropdown-separator"}),65),a.add("approve",h().component({className:"Button",disabled:!e().forum.attribute("canApproveBlogPosts"),onclick:()=>{t.blogMeta().save({isPendingReview:!1}).then(()=>{e().alerts.show(At(),{type:"success"},e().translator.trans("vadkuz-flarum2-blog.forum.review_article.approve_article_approved"))},t=>{this.loading=!1,this.handleErrors(t)})},icon:"fas fa-thumbs-up"},e().translator.trans("vadkuz-flarum2-blog.forum.review_article.approve_article")),60)),t.canChangeLanguage&&t.canChangeLanguage()&&o&&a.add("lang",h().component({icon:"fas fa-globe",onclick:()=>e().modal.show(o,{discussion:t})},e().translator.trans("fof-discussion-language.forum.discussion_controls.change_language_button")),50),a.add("separator2",m("li",{className:"Dropdown-separator"}),40),t.canLock()&&a.add("lock",h().component({className:"Button",onclick:yt().lockAction.bind(t),icon:"fas ".concat(t.isLocked()?"fa-comments":"fa-comment-slash")},t.isLocked()?e().translator.trans("vadkuz-flarum2-blog.forum.tools.enable_comments"):e().translator.trans("vadkuz-flarum2-blog.forum.tools.disable_comments")),30),t.canHide()&&(t.isHidden()?(a.add("recover",h().component({className:"Button",onclick:yt().restoreAction.bind(t),icon:"fas fa-eye"},e().translator.trans("vadkuz-flarum2-blog.forum.tools.recover_article")),20),t.canDelete()&&a.add("delete",h().component({className:"Button",onclick:()=>{if(confirm(St()(e().translator.trans("core.forum.discussion_controls.delete_confirmation"))))return"blogArticle"===e().history.getCurrent().name&&(e().previous?e().history.back():m.route.set(e().route("blog"))),t.delete().then(()=>{m.redraw()})},icon:"far fa-trash-alt"},e().translator.trans("vadkuz-flarum2-blog.forum.tools.delete_forever")),10)):a.add("hide",h().component({className:"Button",onclick:yt().hideAction.bind(t),icon:"fas fa-eye-slash"},e().translator.trans("vadkuz-flarum2-blog.forum.tools.hide_article")),0)),a}view(){const t=this.attrs.article.firstPost();return m("div",{className:"FlarumBlog-Article-Content-Edit-Button"},m("div",{className:"FlarumBlog-Article-Content-Edit-Dropdown"},Ft().component({icon:"fas fa-cog",label:e().translator.trans("vadkuz-flarum2-blog.forum.tools.manage"),buttonClassName:"Button",menuClassName:"Dropdown-menu--right",onshow:()=>{!t||t.canEdit()||this.loadedPost||(this.loadedPost=!0,m.redraw())}},this.manageArticleButtons().toArray())))}}flarum.reg.add("vadkuz-flarum2-blog","forum/components/BlogPostController",Pt);class Lt extends(b()){view(){return m("div",{className:"FlarumBlog-Article-Sidebar"},m("ul",null,Y()(this.items().toArray())))}items(){const t=new(D());return t.add("author",tt.component(this.attrs),0),t.add("categories",k.component(this.attrs),0),t.add("nav",N.component(this.attrs),0),t}}flarum.reg.add("vadkuz-flarum2-blog","forum/components/BlogItemSidebar/BlogItemSidebar",Lt);const Dt=flarum.reg.get("core","common/helpers/fullTime");var Tt=t.n(Dt);class Rt extends(b()){view(){const t=this.attrs.discussion.subscription(),a=app.session.user.preferences().notify_newPost_email,e=St()(app.translator.trans(a?"flarum-subscriptions.forum.sub_controls.notify_email_tooltip":"flarum-subscriptions.forum.sub_controls.notify_alert_tooltip"));let o=app.translator.trans("flarum-subscriptions.forum.sub_controls.not_following_button"),s="far fa-star";return"follow"===t&&(o=app.translator.trans("flarum-subscriptions.forum.sub_controls.following_button"),s="fas fa-star"),m(I(),{text:e,position:"bottom"},m(h(),{className:"Button BlogArticleSubscription SubscriptionMenu-button--".concat(t),icon:s,onclick:this.saveSubscription.bind(this,this.attrs.discussion,-1!==["follow","ignore"].indexOf(t)?null:"follow")},o))}saveSubscription(t,a){t.save({subscription:a})}}flarum.reg.add("vadkuz-flarum2-blog","forum/components/ArticleSubscription",Rt);class Et extends(g()){oninit(t){super.oninit(t),e().setTitle(e().translator.trans("vadkuz-flarum2-blog.forum.blog")),e().history.push("blogArticle"),this.bodyClass="BlogItemPage",this.near=m.route.param("near")||0,this.loading=!0,this.found=!1,this.article=null,this.PostStream=null,this.loadPostStreamComponent(),this.loadBlogItem()}loadPostStreamComponent(){flarum.reg.asyncModuleImport("flarum/forum/components/PostStream").then(t=>{this.PostStream=t.default,m.redraw()})}loadBlogItem(){const t=e().preloadedApiDocument();t?setTimeout(this.show.bind(this,t),0):e().store.find("discussions",m.route.param("id").split("-")[0]).then(this.show.bind(this)).catch(()=>{m.redraw()}),m.redraw()}show(t){this.article=t,e().setTitle("".concat(t.title()," - ").concat(e().translator.trans("vadkuz-flarum2-blog.forum.blog"))),this.loading=!1;let a=[];if(t.payload&&t.payload.included){const o=t.id();a=t.payload.included.filter(t=>"posts"===t.type&&t.relationships&&t.relationships.discussion&&t.relationships.discussion.data.id===o).map(t=>e().store.getById("posts",t.id)).sort((t,a)=>t.id()-a.id()).slice(0,20)}this.stream=new(zt())(t,a),this.near&&this.stream.goToNumber(this.near||0,!0).then(()=>{e().current.set("discussion",t),e().current.set("stream",this.stream)}),e().session.user&&!t.lastReadPostNumber()&&t.save({lastReadPostNumber:1}),m.redraw()}postItems(){var t,a,o,s;let l=null;var r,i;!this.loading&&this.article&&(l=null==(r=this.article)||null==(i=r.firstPost)?void 0:i.call(r));const n=new(D());var u,c,d;return n.add("title",m("h1",{className:P()("FlarumBlog-Article-Title",{"FlarumBlog-Article-GhostTitle":this.loading})},(null==this||null==(t=this.article)||null==(a=t.title)?void 0:a.call(t))||e().translator.trans("vadkuz-flarum2-blog.forum.placeholders.ghost_title"),(null==(o=this.article)||null==(s=o.isHidden)?void 0:s.call(o))&&"(".concat(e().translator.trans("vadkuz-flarum2-blog.forum.hidden"),")")),100),n.add("publishDate",m("div",{className:P()("FlarumBlog-Article-PublishDate",{"FlarumBlog-Article-GhostPublishDate":this.loading})},this.article?Tt()(this.article.createdAt()):m("span",null," ")),80),this.loading&&n.add("skeleton",[0,1,2].map(()=>m("div",null,m("p",{className:"FlarumBlog-Article-GhostParagraph"}," "),m("p",{className:"FlarumBlog-Article-GhostParagraph"}," "),m("p",{className:"FlarumBlog-Article-GhostParagraph"}," "),m("p",null," "))),60),this.loading||(null!=(u=(c=this.article).blogMeta)&&null!=(u=u.call(c))&&null!=(d=u.isPendingReview)&&d.call(u)&&n.add("review",m("div",{className:"Post-body"},m("blockquote",{class:"uncited",style:{fontSize:"16px"}},m("div",null,m(C(),{name:"far fa-clock",style:{marginRight:"5px"}})," ",e().translator.trans("vadkuz-flarum2-blog.forum.review_article.pending_review")))),60),l&&n.add("post",m(kt(),{post:l}),40)),n}contentItems(){var t,a,o,s,l,r,i,n,u,c,d,g,f;const h=e().forum.attribute("blogDefaultImage")?"url(".concat(e().forum.attribute("baseUrl"),"/assets/").concat(e().forum.attribute("blogDefaultImage"),")"):null,p=null!=(t=this.article)&&null!=(t=t.blogMeta())&&null!=(a=t.featuredImage)&&a.call(t)?"url(".concat(this.article.blogMeta().featuredImage(),")"):h,b=new(D());return b.add("image",m("div",{className:P()("FlarumBlog-Article-Image FlarumBlog-default-image",{"FlarumBlog-Article-GhostImage":this.loading}),style:{backgroundImage:p,opacity:null!=(o=this.article)&&null!=(s=o.isHidden)&&s.call(o)?.4:null}}),100),this.article&&(null!=(l=e().session.user)&&null!=(r=l.canEdit)&&r.call(l)||null!=(i=this.article)&&null!=(n=i.canRename)&&n.call(i)||null!=(u=this.article)&&null!=(c=u.posts)&&null!=(c=c.call(u))&&null!=(c=c[0])&&null!=(d=c.canEdit)&&d.call(c))&&b.add("editArticle",m(Pt,{article:this.article}),80),b.add("categories",m("div",{className:"FlarumBlog-Article-Categories"},!this.loading&&(null==(g=this.article)||null==(f=g.tags)||null==(f=f.call(g))?void 0:f.map(t=>m(_(),{href:e().route("blogCategory",{slug:t.slug()})},t.name()))),this.loading&&[0,1].map(()=>m("span",{className:"FlarumBlog-Article-GhostCategory"},e().translator.trans("vadkuz-flarum2-blog.forum.placeholders.ghost_category")))),60),b.add("post",m("div",{className:"FlarumBlog-Article-Post"},this.postItems().toArray()),40),b}articleItems(){var t,a,o,s;const l=new(D());var r,i;return l.add("content",m("div",{className:"FlarumBlog-Article-Content"},this.contentItems().toArray()),100),null!=this&&null!=(t=this.article)&&null!=(a=t.isLocked)&&a.call(t)&&1===(null==this||null==(o=this.article)||null==(s=o.commentCount)?void 0:s.call(o))||l.add("comments",m("div",{className:"FlarumBlog-Article-Comments"},!this.loading&&e().session.user&&this.article.subscription&&(!this.article.isLocked||this.article.isLocked&&!this.article.isLocked())&&m(Rt,{discussion:this.article}),m("h4",null,e().translator.trans("vadkuz-flarum2-blog.forum.comment_section.comments")," (",this.article?this.article.commentCount()-1:0,")"),!this.loading&&(null==(r=this.article)||null==(i=r.isLocked)?void 0:i.call(r))&&m("div",{className:"Post-body"},m("blockquote",{class:"uncited"},m("div",null,m("span",{className:"far fa-lock",style:{marginRight:"5px"}})," ",e().translator.trans("vadkuz-flarum2-blog.forum.comment_section.locked")))),!this.loading&&this.article&&this.PostStream&&m(this.PostStream,{discussion:this.article,stream:this.stream,onPositionChange:this.positionChanged.bind(this)})),75),l}view(){return[1==e().forum.attribute("blogAddHero")&&c().prototype.hero(),m("div",{className:"FlarumBlogItem"},m("div",{className:"container"},m("div",{className:"FlarumBlog-ToolButtons"},m(_(),{href:e().route("blog"),className:"Button",onclick:t=>{e().previous.matches(E)&&(t.preventDefault(),history.back())}},m("i",{class:"icon fas fa-angle-left Button-icon"}),m("span",{class:"Button-label"},e().translator.trans("vadkuz-flarum2-blog.forum.return_to_overview")))),m("div",{className:"FlarumBlog-Article"},m("div",{className:"FlarumBlog-Article-Container"},this.articleItems().toArray()),m(Lt,{article:this.article,loading:this.loading}))))]}positionChanged(t,a){const o=this.article;e().session.user&&a>(o.lastReadPostNumber()||0)&&(o.save({lastReadPostNumber:a}),m.redraw())}}flarum.reg.add("vadkuz-flarum2-blog","forum/pages/BlogItem",Et),e().initializers.add("vadkuz-flarum2-blog",t=>{vt(t),t.routes.blog={path:"/blog",component:E},t.routes.blogCategory={path:"/blog/category/:slug",component:E},t.routes.blogComposer={path:"/blog/compose",component:gt},t.routes.blogArticle={path:"/blog/:id",component:Et},t.routes["blogArticle.near"]={path:"/blog/:id/:near",component:Et},t.store.models.blogMeta=q,n().prototype.blogMeta=s().hasOne("blogMeta"),r().prototype.isBlog=s().attribute("isBlog"),function(){const t=(t,a)=>{var e,o,s,l;if(!t||!Array.isArray(a)||0===a.length)return!1;const r=parseInt(null==(e=t.id)?void 0:e.call(t),10),i=null!=(o=t.parent)&&o.call(t)?parseInt(null==(s=(l=t.parent()).id)?void 0:s.call(l),10):null;return a.includes(r)||null!==i&&a.includes(i)};(0,H.extend)(c().prototype,"oncreate",function(){const a="function"==typeof e().currentTag?e().currentTag():null,o="both"===e().forum.attribute("blogRedirectsEnabled")||"tags_only"===e().forum.attribute("blogRedirectsEnabled");if(a&&o){const o=e().forum.attribute("blogTags")||[];t(a,o)&&m.route.set(e().route("blogCategory",{slug:a.slug()}))}}),(0,H.override)(G().prototype,"show",function(a,o){if(("both"===e().forum.attribute("blogRedirectsEnabled")||"discussions_only"===e().forum.attribute("blogRedirectsEnabled"))&&o&&o.tags().length>0){const a=e().forum.attribute("blogTags")||[];if(o.tags().filter(e=>t(e,a)).length>0){const t=e().route("blogArticle",{id:o.slug()});return m.route.set(t,null,{replace:!0}),null}}return a(o)})}(),J(),Q(),pt()},-1e5)})(),module.exports={}})();
//# sourceMappingURL=forum.js.map